I"∑ú<hr />
<p>bebop_autonomy - ROS Driver for Parrot Bebop Drone (quadrocopter) 1.0 &amp; 2.0
<strong>**</strong><strong>**</strong><strong>**</strong><strong>**</strong><strong>**</strong><strong>**</strong><strong>**</strong><strong>**</strong><strong>**</strong><strong>**</strong><strong>**</strong><strong>**</strong><em>**</em></p>

<p><em>bebop_autonomy</em> is a :abbr:<code class="language-plaintext highlighter-rouge">ROS (Robot Operating System)</code> driver for <code class="language-plaintext highlighter-rouge">Parrot Bebop 1.0 &lt;http://www.parrot.com/ca/products/bebop-drone/&gt;</code>_ and <code class="language-plaintext highlighter-rouge">2.0 &lt;https://www.parrot.com/ca/drones/parrot-bebop-2&gt;</code>_ drones (quadrocopters), based on Parrot‚Äôs official <code class="language-plaintext highlighter-rouge">ARDroneSDK3 &lt;http://developer.parrot.com/docs/SDK3/&gt;</code><em>. This driver has been developed in <code class="language-plaintext highlighter-rouge">Autonomy Lab &lt;http://autonomylab.org/&gt;</code></em> of <code class="language-plaintext highlighter-rouge">Simon Fraser University &lt;http://www.sfu.ca/&gt;</code>_ by <code class="language-plaintext highlighter-rouge">Mani Monajjemi &lt;http://mani.im&gt;</code>_ and other contributers (:ref:<code class="language-plaintext highlighter-rouge">sec-contribs</code>). This software is maintained by <code class="language-plaintext highlighter-rouge">Sepehr MohaimenianPour &lt;http://sepehr.im/&gt;</code>_ (AutonomyLab, Simon Fraser University), <code class="language-plaintext highlighter-rouge">Thomas Bamford &lt;#&gt;</code>_ (Dynamic Systems Lab, University of Toronto) and <code class="language-plaintext highlighter-rouge">Tobias Naegeli &lt;https://ait.ethz.ch/people/naegelit/&gt;</code>_ (Advanced Interactive Technologies Lab, ETH Z√ºrich).</p>

<p>[<code class="language-plaintext highlighter-rouge">Source Code &lt;https://github.com/AutonomyLab/bebop_autonomy&gt;</code><em>] 
[<code class="language-plaintext highlighter-rouge">ROS wiki page &lt;http://wiki.ros.org/bebop_autonomy&gt;</code></em>] 
[<code class="language-plaintext highlighter-rouge">Support &lt;http://answers.ros.org/questions/scope:all/sort:activity-desc/tags:bebop_autonomy/page:1/&gt;</code><em>] 
[<code class="language-plaintext highlighter-rouge">Bug Tracker &lt;https://github.com/AutonomyLab/bebop_autonomy/issues&gt;</code></em>]</p>

<p>.. _sec-roadmap:</p>

<h1 id="features-and-roadmap">Features and Roadmap</h1>

<p>.. csv-table::
  :header: ‚ÄúFeature‚Äù, ‚ÄúStatus‚Äù, ‚ÄúNotes‚Äù</p>

<p>SDK Version,‚Äù3.12.6‚Äù, ‚ÄúSince v0.7‚Äù
  Support for Parrot Bebop 1, Yes, ‚ÄúTested up to Firmware 3.3‚Äù
  Support for Parrot Bebop 2, Yes, ‚ÄúTested up to Firmware 4.0.6‚Äù
  Support for Parrot Disco FPV, No, ‚ÄúNot tested (help wanted)‚Äù
  Core piloting, Yes, ‚Äú‚Äù
  H264 video decoding, Yes, ‚ÄúEnhancement: <code class="language-plaintext highlighter-rouge">#1 &lt;https://github.com/AutonomyLab/bebop_autonomy/issues/1&gt;</code><em>‚Äù
  ROS Camera Interface, Yes, ‚Äú‚Äù
  Nodelet implementation, Yes, ‚Äú‚Äù
  Publish Bebop states as ROS topics, Yes, ‚Äú‚Äù
  Dynamically reconfigurable Bebop settings, Yes, ‚Äú:ref:<code class="language-plaintext highlighter-rouge">sec-dev-dyn</code>‚Äù
  Use <code class="language-plaintext highlighter-rouge">parrot_arsdk &lt;https://github.com/AutonomyLab/parrot_arsdk&gt;</code></em> instead of building ARSDK3 inline, Yes, ‚ÄúSince v0.6: <code class="language-plaintext highlighter-rouge">#75 &lt;https://github.com/AutonomyLab/bebop_autonomy/issues/75&gt;</code>_‚Äù
  Bebop In The Loop tests, Yes, ‚Äú:ref:<code class="language-plaintext highlighter-rouge">sec-dev-test</code>‚Äù
  Joystick teleop demo, Yes, ‚Äú:ref:<code class="language-plaintext highlighter-rouge">sec-pilot-teleop</code>‚Äù
  TF Publisher, Yes, ‚ÄúSince v0.5 (:ref:<code class="language-plaintext highlighter-rouge">sec-tf</code>)‚Äù
  Odometry Publisher, Yes, ‚ÄúSince v0.5 (:ref:<code class="language-plaintext highlighter-rouge">sec-odom</code>)‚Äù
  Provide ROS API for on-board picture/video recording, Yes, ‚ÄúSince v0.4.1 (:ref:<code class="language-plaintext highlighter-rouge">sec-snapshot</code>)‚Äù
  GPS Support, Yes, ‚ÄúSince v0.6 (:ref:<code class="language-plaintext highlighter-rouge">sec-gps</code>)‚Äù
  Support for 720p streaming, Yes, ‚ÄúSince v0.6‚Äù
  Mavlink Support, No, ‚Äú‚Äù
  Binary Release, No, ‚Äú‚Äù
  Support for Parrot Sky Controller, No, ‚Äú‚Äù</p>

<h1 id="table-of-contents">Table of Contents</h1>

<p>.. toctree::
  :maxdepth: 2</p>

<p>changelog
  installation
  running
  piloting
  reading
  configuration
  coordinates
  contribute
  FAQ
  dev
  license</p>

<h1 id="indices-and-tables">Indices and tables</h1>

<ul>
  <li>:ref:<code class="language-plaintext highlighter-rouge">genindex</code></li>
  <li>:ref:<code class="language-plaintext highlighter-rouge">modindex</code></li>
  <li>:ref:<code class="language-plaintext highlighter-rouge">search</code></li>
</ul>

<hr />

<hr />

<hr />
<p>Installation
<strong>**</strong><strong>**</strong></p>

<h1 id="compiling-from-source">Compiling From Source</h1>

<p>Pre-requirements:</p>

<ul>
  <li>ROS <em>Indigo</em>, <em>Jade</em> or <em>Kinetic</em> (Only tested on <em>Ubuntu</em>)</li>
  <li>Ubuntu packages: <code class="language-plaintext highlighter-rouge">build-esstential</code>, <code class="language-plaintext highlighter-rouge">python-rosdep</code>, <code class="language-plaintext highlighter-rouge">python-catkin-tools</code></li>
  <li>Basic familiarity with building ROS packages</li>
</ul>

<p>.. code-block:: bash</p>

<p>$ sudo apt-get install build-essential python-rosdep python-catkin-tools</p>

<p>To compile from source, you need to clone the source code in a new or existing <code class="language-plaintext highlighter-rouge">catkin</code> workspace, use <code class="language-plaintext highlighter-rouge">rosdep</code> to install dependencies and finally compile the workspace using <code class="language-plaintext highlighter-rouge">catkin</code>. The following commands demonstrate this procedure in a newly created <code class="language-plaintext highlighter-rouge">catkin</code> workspace.</p>

<p>.. note:: Since version 0.6, <code class="language-plaintext highlighter-rouge">Parrot ARSDK &lt;http://developer.parrot.com/docs/SDK3/&gt;</code><em>, the main underlying dependency of  *bebop_autonomy* is not build inline anymore. Instead, the slightly patched and catkinized version of it, called <code class="language-plaintext highlighter-rouge">parrot_arsdk &lt;https://github.com/AutonomyLab/parrot_arsdk&gt;</code></em>, is fetched as a dependency during the <code class="language-plaintext highlighter-rouge">rosdep install</code> step below. This dramatically decreases the compile time of the package compared to previous versions (e.g. from ~15 minutes to less than a minute on a modern computer). If you are re-compiling from source, you need to clean your workspace first: <code class="language-plaintext highlighter-rouge">$ catkin clean [-y]</code>.</p>

<p>.. code-block:: bash</p>

<p># Create and initialize the workspace
  $ mkdir -p ~/bebop_ws/src &amp;&amp; cd ~/bebop_ws
  $ catkin init
  $ git clone https://github.com/AutonomyLab/bebop_autonomy.git src/bebop_autonomy
  # Update rosdep database and install dependencies (including parrot_arsdk)
  $ rosdep update
  $ rosdep install ‚Äìfrom-paths src -i
  # Build the workspace
  $ catkin build</p>

<hr />

<hr />

<hr />
<p>Running the Driver
<strong>**</strong><strong>**</strong><strong>**</strong></p>

<p>You can run Bebop‚Äôs ROS drivereither as a ROS <code class="language-plaintext highlighter-rouge">Nodelet &lt;http://wiki.ros.org/nodelet&gt;</code>_ or as a standalone ROS Node. The former is recommended if you intend to perform any kind of processing on Bebop‚Äôs video stream.</p>

<p>.. note:: If you compile the driver form source, do not forget to source your catkin workspace prior to running the driver. (i.e. <code class="language-plaintext highlighter-rouge">source ~/bebop_ws/devel/setup.[bash|zsh]</code>)</p>

<p>.. note:: Ensure that your Bebop‚Äôs firmware is at least <strong>2.0.29</strong> and your computer is connected to Bebop‚Äôs wireless network.</p>

<h1 id="running-the-driver-as-a-node">Running the driver as a Node</h1>

<p>The executable node is called <code class="language-plaintext highlighter-rouge">bebop_driver_node</code> and exists in <code class="language-plaintext highlighter-rouge">bebop_driver</code> package. It‚Äôs recommended to run the Node in its own namespace and with default configuration. The driver package comes with a sample launch file <code class="language-plaintext highlighter-rouge">bebop_driver/launch/bebop_node.launch</code> which demonstrates the procedure.</p>

<p>.. code-block:: bash</p>

<p>$ roslaunch bebop_driver bebop_node.launch</p>

<p>.. literalinclude::
  ../bebop_driver/launch/bebop_node.launch
  :language: XML
  :caption: bebop_node.launch</p>

<h1 id="running-the-driver-as-a-nodelet">Running the driver as a Nodelet</h1>

<p>To run the driver as a ROS Nodelet, you need to first run a Nodelet manager, then load the driver‚Äôs Nodelet (<code class="language-plaintext highlighter-rouge">bebop_driver/BebopDriverNodelet</code>) in it, along with other Nodelets that need to communicate with the driver. <code class="language-plaintext highlighter-rouge">bebop_tools/launch/bebop_nodelet_iv.launch</code> is a sample launch file that demonstrates these steps by visualizing Bebop‚Äôs video stream using an instance of <code class="language-plaintext highlighter-rouge">image_view/image &lt;http://wiki.ros.org/image_view#image_view.2BAC8-diamondback.image_view.2BAC8-image&gt;</code>_ Nodelet. Similar to <code class="language-plaintext highlighter-rouge">bebop_node.launch</code>, it also runs everything in its own namespace and loads the default configuration.</p>

<p>.. code-block:: bash</p>

<p>$ roslaunch bebop_tools bebop_nodelet_iv.launch</p>

<p>.. literalinclude::
  ../bebop_tools/launch/bebop_nodelet_iv.launch
  :language: XML
  :caption: bebop_tools/launch/bebop_nodelet_iv.launch</p>

<p>.. literalinclude::
  ../bebop_driver/launch/bebop_nodelet.launch
  :language: XML
  :caption: bebop_driver/launch/bebop_nodelet.launch</p>

<hr />

<hr />

<hr />
<p>Sending Commands to Bebop
<strong>**</strong><strong>**</strong><strong>**</strong><strong>**</strong>*</p>

<p>.. _sec-pilot-teleop:</p>

<p>.. note:: <code class="language-plaintext highlighter-rouge">bebop_tools</code> package comes with a launch file for tele-operating Bebop with a joystick using ROS <code class="language-plaintext highlighter-rouge">joy_teleop &lt;http://wiki.ros.org/joy_teleop&gt;</code>_ package. The configuration file (key-action map) is written for <code class="language-plaintext highlighter-rouge">Logitech F710 controller &lt;http://gaming.logitech.com/en-ca/product/f710-wireless-gamepad&gt;</code>_ and is located in <code class="language-plaintext highlighter-rouge">bebop_tools/config</code> folder. Adapting the file to your own controller is straightforward. To teleop Bebop while the driver is running execute <code class="language-plaintext highlighter-rouge">roslaunch bebop_tools joy_teleop.launch</code>.</p>

<h1 id="takeoff">Takeoff</h1>

<p>Publish a message of type <code class="language-plaintext highlighter-rouge">std_msgs/Empty</code> to <code class="language-plaintext highlighter-rouge">takeoff</code> topic.</p>

<p>.. code-block:: bash</p>

<p>$ rostopic pub ‚Äìonce [namespace]/takeoff std_msgs/Empty</p>

<h1 id="land">Land</h1>

<p>Publish a message of type <code class="language-plaintext highlighter-rouge">std_msgs/Empty</code> to <code class="language-plaintext highlighter-rouge">land</code> topic.</p>

<p>.. code-block:: bash</p>

<p>$ rostopic pub ‚Äìonce [namespace]/land std_msgs/Empty</p>

<h1 id="emergency">Emergency</h1>

<p>Publish a message of type <code class="language-plaintext highlighter-rouge">std_msgs/Empty</code> to <code class="language-plaintext highlighter-rouge">reset</code> topic.</p>

<p>.. code-block:: bash</p>

<p>$ rostopic pub ‚Äìonce [namespace]/reset std_msgs/Empty</p>

<h1 id="piloting">Piloting</h1>

<p>To move Bebop around, publish messages of type <code class="language-plaintext highlighter-rouge">geometry_msgs/Twist &lt;http://docs.ros.org/api/geometry_msgs/html/msg/Twist.html&gt;</code>_ to <code class="language-plaintext highlighter-rouge">cmd_vel</code> topic while Bebop is flying. The effect of each field of the message on Bebop‚Äôs movement is listed below:</p>

<p>.. code-block:: text</p>

<p>linear.x  (+)      Translate forward
            (-)      Translate backward
  linear.y  (+)      Translate to left
            (-)      Translate to right
  linear.z  (+)      Ascend
            (-)      Descend
  angular.z (+)      Rotate counter clockwise
            (-)      Rotate clockwise</p>

<p>Acceptable range for all fields are <code class="language-plaintext highlighter-rouge">[-1..1]</code>. The drone executes the last received command as long as the driver is running. This command is reset to zero when Takeoff_, Land_ or Emergency_ command is received. To make Bebop hover and maintain its current position, you need to publish a message with all fields set to zero to <code class="language-plaintext highlighter-rouge">cmd_vel</code>.</p>

<p>The <code class="language-plaintext highlighter-rouge">linear.x</code> and <code class="language-plaintext highlighter-rouge">linear.y</code> parts of this message set the <strong>pitch</strong> and <strong>roll</strong> angles of the Bebop, respectively, hence control its forward and lateral accelerations. The resulting pitch/roll angles depend on the value of <code class="language-plaintext highlighter-rouge">~PilotingSettingsMaxTiltCurrent</code> <code class="language-plaintext highlighter-rouge">parameter &lt;./autogenerated/ardrone3_settings_param.html#pilotingsettingsmaxtiltcurrent&gt;</code>_, which is specified in degrees and is dynamically reconfigurable (:ref:<code class="language-plaintext highlighter-rouge">sec-dyn-params</code>).</p>

<p>The <code class="language-plaintext highlighter-rouge">linear.z</code> part of this message controls the <strong>vertical velocity</strong> of the Bebop. The resulting velocity in m/s depends on the value of <code class="language-plaintext highlighter-rouge">~SpeedSettingsMaxVerticalSpeedCurrent</code> <code class="language-plaintext highlighter-rouge">parameter &lt;./autogenerated/ardrone3_settings_param.html#speedsettingsmaxverticalspeedcurrent&gt;</code><em>, which is specified in meters per second and is also dynamically reconfigurable (:ref:<code class="language-plaintext highlighter-rouge">sec-dyn-params</code>). Similarly, the <code class="language-plaintext highlighter-rouge">angular.z</code> component of this message controls the rotational velocity of the Bebop (around the z-axis). The corresponding scaling <code class="language-plaintext highlighter-rouge">parameter &lt;./autogenerated/ardrone3_settings_param.html#speedsettingsmaxrotationspeedcurrent&gt;</code></em> is <code class="language-plaintext highlighter-rouge">SpeedSettingsMaxRotationSpeedCurrent</code> (in degrees per sec).</p>

<p>.. code-block:: text</p>

<p>roll_degree       = linear.y  * max_tilt_angle
  pitch_degree      = linear.x  * max_tilt_angle
  ver_vel_m_per_s   = linear.z  * max_vert_speed
  rot_vel_deg_per_s = angular.z * max_rot_speed</p>

<h1 id="moving-the-virtual-camera">Moving the Virtual Camera</h1>

<p>To move Bebop‚Äôs virtual camera, publish a message of type <code class="language-plaintext highlighter-rouge">geometry_msgs/Twist &lt;http://docs.ros.org/api/geometry_msgs/html/msg/Twist.html&gt;</code>_ to <code class="language-plaintext highlighter-rouge">camera_control</code> topic. <code class="language-plaintext highlighter-rouge">angular.y</code> and <code class="language-plaintext highlighter-rouge">angular.z</code> fields of this message set <strong>absolute</strong> tilt and pan of the camera in <strong>degrees</strong> respectively. The field of view of this virtual camera (based on our measurements) is ~80 (horizontal) and ~50 (vertical) degrees.</p>

<p>.. warning:: The API for this command is not stable. We plan to use <code class="language-plaintext highlighter-rouge">JointState</code> message in future versions.</p>

<p>.. code-block:: text</p>

<p>angular.y (+)      tilt down
            (-)      tilt up
  angular.z (+)      pan left
            (-)      pan right</p>

<h1 id="gps-navigation">GPS Navigation</h1>

<h2 id="start-flight-plan">Start Flight Plan</h2>

<p>An autonomous flight plan consists of a series of GPS waypoints along with Bebop velocities and camera angles encoded in an XML file.</p>

<p>Requirements that must be met before an autonomous flight can start:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>* Bebop is calibrated
* Bebop is in outdoor mode
* Bebop has fixed its GPS
</code></pre></div></div>

<p>To start an autonomous flight plan, publish a message of type <code class="language-plaintext highlighter-rouge">std_msgs/String &lt;http://docs.ros.org/api/std_msgs/html/msg/String.html&gt;</code>_ to <code class="language-plaintext highlighter-rouge">autoflight/start</code> topic. The <code class="language-plaintext highlighter-rouge">data</code> field should contain the name of the flight plan to execute, which is already stored on-board Bebop.</p>

<p>.. note:: If an empty string is published, then the default ‚Äòflightplan.mavlink‚Äô is used.</p>

<p>.. warning:: If not already flying, Bebop will attempt to take off upon starting a flight plan.</p>

<p>The <code class="language-plaintext highlighter-rouge">Flight Plan App &lt;https://play.google.com/store/apps/details?id=com.parrot.freeflight3&gt;</code>_ allows easy construction of flight plans and saves them on-board Bebop.</p>

<p>An FTP client can also be used to view and copy flight plans on-board Bebop. <code class="language-plaintext highlighter-rouge">FileZilla</code> is recommended:</p>

<p>.. code-block:: bash</p>

<p>$ sudo apt-get install filezilla
  $ filezilla</p>

<p>Then open <code class="language-plaintext highlighter-rouge">Site Manager</code> (top left), click <code class="language-plaintext highlighter-rouge">New Site</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>* `Host`: 192.168.42.1
* `Protocol`: FTP
* `Encrpytion`: Use plain FTP
* `Logon Type`: Anonymous
* Connect.
</code></pre></div></div>

<h2 id="pause-flight-plan">Pause Flight Plan</h2>

<p>To pause the execution of an autonomous flight plan, publish a message of type <code class="language-plaintext highlighter-rouge">std_msgs/Empty &lt;http://docs.ros.org/api/std_msgs/html/msg/Empty.html&gt;</code>_ to <code class="language-plaintext highlighter-rouge">autoflight/pause</code> topic. Bebop will then hover and await further commands.
To resume a paused flight plan, publish the same message that was used to start the autonomous flight (ie. to the topic <code class="language-plaintext highlighter-rouge">autoflight/start</code>). Bebop will fly to the lastest waypoint reached before continuing the flight plan.</p>

<p>.. note:: Any velocity commands sent to Bebop during an autonomous flight plan will pause the plan.</p>

<h2 id="stop-flight-plan">Stop Flight Plan</h2>

<p>To stop the execution of an autonomous flight plan, publish a message of type <code class="language-plaintext highlighter-rouge">std_msgs/Empty &lt;http://docs.ros.org/api/std_msgs/html/msg/Empty.html&gt;</code>_ to <code class="language-plaintext highlighter-rouge">autoflight/stop</code> topic. Bebop will hover and await further commands.</p>

<h2 id="navigate-home">Navigate Home</h2>

<p>To ask Bebop to autonomously fly to it‚Äôs home position, publish a message of type <code class="language-plaintext highlighter-rouge">std_msgs/Bool &lt;http://docs.ros.org/api/std_msgs/html/msg/Bool.html&gt;</code>_ to <code class="language-plaintext highlighter-rouge">autoflight/navigate_home</code> topic with the <code class="language-plaintext highlighter-rouge">data</code> field set to <code class="language-plaintext highlighter-rouge">true</code>. To stop Bebop from navigating home, publish another message with <code class="language-plaintext highlighter-rouge">data</code> set to <code class="language-plaintext highlighter-rouge">false</code>.</p>

<p>.. warning:: The topic has changed from <code class="language-plaintext highlighter-rouge">navigate_home</code> to <code class="language-plaintext highlighter-rouge">autoflight/navigate_home</code> after version 0.5.1.</p>

<h1 id="flat-trim">Flat Trim</h1>

<p>.. error:: Test fails, probably not working.</p>

<p>Publish a message of type <code class="language-plaintext highlighter-rouge">std_msgs/Empty</code> to <code class="language-plaintext highlighter-rouge">flattrim</code> topic.</p>

<p>.. code-block:: bash</p>

<p>$ rostopic pub ‚Äìonce [namespace]/flattrim std_msgs/Empty</p>

<h1 id="flight-animations">Flight Animations</h1>

<p>.. warning:: Be extra cautious when performing any flight animations, specially in indoor environments.</p>

<p>Bebop can perform four different types of flight animation (flipping). To perform an animation, publish a message of type <code class="language-plaintext highlighter-rouge">std_msgs/UInt8</code> to <code class="language-plaintext highlighter-rouge">flip</code> topic while drone is flying. The <code class="language-plaintext highlighter-rouge">data</code> field determines the requested animation type.</p>

<p>.. code-block:: text</p>

<p>0       Flip Forward
  1       Flip Backward
  2       Flip Right
  3       Flip Left</p>

<p>.. _sec-snapshot:</p>

<h1 id="take-on-board-snapshot">Take on-board Snapshot</h1>

<p>.. versionadded:: 0.4.1</p>

<p>To take a high resolution on-board snapshot, publish a <code class="language-plaintext highlighter-rouge">std_msgs/Empty</code> message on <code class="language-plaintext highlighter-rouge">snapshot</code> topic. The resulting snapshot is stored on the internal storage of the Bebop. The quality and type of this image is not configurable using the ROS driver. You can use the official FreeFlight3 app to configure your Bebop prior to flying. To access the on-board media, either connect your Bebop over USB to a computer, or use a FTP client to connect to your Bebop using the following settings:</p>

<ul>
  <li>Default IP: <code class="language-plaintext highlighter-rouge">192.168.42.1</code></li>
  <li>Port: <code class="language-plaintext highlighter-rouge">21</code></li>
  <li>Path: <code class="language-plaintext highlighter-rouge">internal_000/Bebop_Drone/media</code></li>
  <li>Username: <code class="language-plaintext highlighter-rouge">anonymous</code></li>
  <li>Password: *<no password="">*</no></li>
</ul>

<h1 id="set-camera-exposure">Set camera exposure</h1>

<p>It is possible to set camera exposure by publishing <code class="language-plaintext highlighter-rouge">std_msgs/Float32</code> message on <code class="language-plaintext highlighter-rouge">set_exposure</code> topic. Note that this functionality is not supported in Bebop1 Fw 3.3.0.</p>

<ul>
  <li>Exposure value range: <code class="language-plaintext highlighter-rouge">-3.0 .. +3.0</code></li>
</ul>

<h1 id="toggle-on-board-video-recording">Toggle on-board Video Recording</h1>

<p>.. versionadded:: 0.4.1</p>

<p>To start or stop on-board high-resolution video recording, publish a <code class="language-plaintext highlighter-rouge">std_msgs/Bool</code> message on the <code class="language-plaintext highlighter-rouge">record</code> topic. The value of <code class="language-plaintext highlighter-rouge">true</code> starts the recording while the value of <code class="language-plaintext highlighter-rouge">false</code> stops it. Please refer to the previous section for information on how to access the on-board recorded media.</p>

<hr />

<hr />

<hr />
<p>Reading from Bebop
<strong>**</strong><strong>**</strong><strong>**</strong></p>

<h1 id="camera">Camera</h1>

<p>The video stream from Bebop‚Äôs front camera is published on <code class="language-plaintext highlighter-rouge">image_raw</code> topic as <code class="language-plaintext highlighter-rouge">sensor_msgs/Image</code> messages. <em>bebop_driver</em> complies with ROS camera interface specifications and publishes camera information and calibration data to <code class="language-plaintext highlighter-rouge">camera_info</code> topic. Due to limitations in Parrot‚Äôs ARDroneSDK3, the quality of video stream is limited to <strong>640 x 368 @ 30 Hz</strong>. The field of view of this virtual camera (based on our measurements) is ~80 (horizontal) and ~50 (vertical) degrees.</p>

<p>To set the location of camera calibration data, please check this page: :doc:<code class="language-plaintext highlighter-rouge">configuration</code>. Since v0.4, the package ships with a default camera caliberation file located at <code class="language-plaintext highlighter-rouge">bebop_driver/data/bebop_front_calib.yaml</code>. Both default node/nodelet launch files, load this file when executing the driver.</p>

<p>.. _sec-ros-topic:</p>

<h1 id="standard-ros-messages">Standard ROS messages</h1>

<p>.. _sec-odom:</p>

<h2 id="odometery">Odometery</h2>

<p>.. versionadded:: 0.5</p>

<ul>
  <li>ROS Topic: <code class="language-plaintext highlighter-rouge">odom</code></li>
  <li>ROS Message Type: <code class="language-plaintext highlighter-rouge">nav_msgs/Odometry</code></li>
</ul>

<p>The driver integerates visual-inertial velocity estimates reported by Bebop‚Äôs firmware to calculate the odometery. This message contains both the position and velocity of the Bebop in an ENU aligned odometery frame also named as <code class="language-plaintext highlighter-rouge">odom</code>. This frame name is configurable (see :ref:<code class="language-plaintext highlighter-rouge">sec-params</code>) The cooridnate frame convention complies with ROS REP 103 (:ref:<code class="language-plaintext highlighter-rouge">sec-coords</code>). Please not that since odometery is calculated from Bebop States (see :ref:<code class="language-plaintext highlighter-rouge">sec-states</code>), the update rate is limited to <strong>5 Hz</strong>.</p>

<p>.. _sec-gps:</p>

<h2 id="gps">GPS</h2>

<p>.. versionadded:: 0.5</p>

<ul>
  <li>ROS Topic: <code class="language-plaintext highlighter-rouge">fix</code></li>
  <li>ROS Message Type: <code class="language-plaintext highlighter-rouge">sensor_msgs/NavSatFix</code></li>
</ul>

<h2 id="joint-states-pantilt-of-the-virtual-camera">Joint States (Pan/Tilt of The Virtual Camera)</h2>

<p>.. versionadded:: 0.5</p>

<ul>
  <li>ROS Topic: <code class="language-plaintext highlighter-rouge">joint_states</code></li>
  <li>ROS Message Type: <code class="language-plaintext highlighter-rouge">sensor_msgs/JointState</code></li>
</ul>

<p>.. _sec-tf:</p>

<h1 id="tf">TF</h1>

<p>.. versionadded:: 0.5</p>

<p>The driver updates the following <code class="language-plaintext highlighter-rouge">TF &lt;http://wiki.ros.org/tf&gt;</code>_ tree based on a simple kinematic model of the Bebop (provided by <code class="language-plaintext highlighter-rouge">bebop_description</code>) pacakge, the current state of the virtual camera joints and the calculated odometery (if <code class="language-plaintext highlighter-rouge">publish_odom_tf</code> is set, see :ref:<code class="language-plaintext highlighter-rouge">sec-params</code>).</p>

<p>.. image:: img/tf.png</p>

<p>.. _sec-states:</p>

<p><img src="https://github.com/AutonomyLab/bebop_autonomy/raw/indigo-devel/docs/img/tf.png" alt="odom_tf" />
States (aka Navdata)</p>

<p>====================</p>

<p>Unlike Parrot ARDrone, Bebop does not constantly transmit all on-board data back to the host device with high frequency. Each state variable is sent only when its value is changed. In addition, the publication rate is currently limited to <strong>5 Hz</strong>. The driver publishes these states <strong>selectively</strong> and when <strong>explicitly</strong> enabled through a ROS parameter. For example setting <code class="language-plaintext highlighter-rouge">~states/enable_pilotingstate_flyingstatechanged</code> parameter to <code class="language-plaintext highlighter-rouge">true</code> will enable the publication of flying state changes to topic <code class="language-plaintext highlighter-rouge">states/ARDrone3/PilotingState/FlyingStateChanged</code>. List of all such parameters and their corresponding topics and message types are indexed in the following pages:</p>

<p>Common States
  :doc:<code class="language-plaintext highlighter-rouge">autogenerated/common_states_param_topic</code>
Bebop-specific States
  :doc:<code class="language-plaintext highlighter-rouge">autogenerated/ardrone3_states_param_topic</code></p>

<hr />

<hr />

<hr />
<p>Configuring Bebop and the Driver
<strong>**</strong><strong>**</strong><strong>**</strong><strong>**</strong><strong>**</strong>**</p>

<p>.. _sec-params:</p>

<h1 id="driver-parameters">Driver Parameters</h1>

<p>Following parameters are set during driver‚Äôs startup:</p>

<h2 id="bebop_ip">~bebop_ip</h2>

<p>Sets the IP addres of the Bebop. The default value is <code class="language-plaintext highlighter-rouge">192.168.42.1</code>.</p>

<h2 id="reset_settings">~reset_settings</h2>

<p>Setting this parameter to <code class="language-plaintext highlighter-rouge">true</code> will reset all Bebop configurations to factory defaults. Default value is <code class="language-plaintext highlighter-rouge">false</code>.</p>

<h2 id="sync_time">~sync_time</h2>

<p>Setting this parameter to <code class="language-plaintext highlighter-rouge">true</code> will synchronize drone time with your ROS system time. Default value is <code class="language-plaintext highlighter-rouge">false</code>.</p>

<h2 id="camera_info_url">~camera_info_url</h2>

<p>Sets the location of the camera calibration data. Default is empty string. For more information check <code class="language-plaintext highlighter-rouge">this documentation &lt;http://wiki.ros.org/camera_info_manager#URL_Names&gt;</code>_.</p>

<p>.. note::</p>

<p>Since v0.4, the package comes with a default camera calibration file located at <code class="language-plaintext highlighter-rouge">bebop_driver/data/bebop_front_calib.yaml</code>.</p>

<h2 id="cmd_vel_timeout">~cmd_vel_timeout</h2>

<p>.. versionadded:: 0.4</p>

<p>Sets the safety timeout for piloting <code class="language-plaintext highlighter-rouge">cmd_vel</code> commands in seconds. Deafult is set to <strong>0.1</strong> seconds (100 miliseconds). If no piloting command is received by the driver within this timeout period, the driver issues a stop command which causes the drone to hover.</p>

<h2 id="odom_frame_id">~odom_frame_id</h2>

<p>.. versionadded:: 0.5</p>

<p>Sets the <code class="language-plaintext highlighter-rouge">frame_id</code> of the odometery message (see :ref:<code class="language-plaintext highlighter-rouge">sec-ros-topic</code>) and the odometery frame used in the TF tree (see :ref:<code class="language-plaintext highlighter-rouge">sec-tf</code>). The default value is <code class="language-plaintext highlighter-rouge">odom</code>.</p>

<h2 id="publish_odom_tf">~publish_odom_tf</h2>

<p>.. versionadded:: 0.5</p>

<p>Enables the publishing of <code class="language-plaintext highlighter-rouge">odom</code> to <code class="language-plaintext highlighter-rouge">base_link</code> TF transform (see :ref:<code class="language-plaintext highlighter-rouge">sec-tf</code>). The default value is <code class="language-plaintext highlighter-rouge">true</code>.</p>

<h2 id="camera_frame_id">~camera_frame_id</h2>

<p>.. deprecated:: 0.5</p>

<p>Sets the <code class="language-plaintext highlighter-rouge">frame_id</code> of camera and image messages. The default value is <code class="language-plaintext highlighter-rouge">camera_optical</code>.</p>

<p>.. _sec-dyn-params:</p>

<h1 id="dynamically-reconfigurable-parameters-for-bebop">Dynamically Reconfigurable Parameters for Bebop</h1>

<p>Following ROS parameters change Bebop‚Äôs settings. They can be tweaked during runtime using <code class="language-plaintext highlighter-rouge">dynamic reconfigure GUI &lt;http://wiki.ros.org/dynamic_reconfigure#dynamic_reconfigure.2BAC8-groovy.reconfigure_gui&gt;</code><em>. Setting <code class="language-plaintext highlighter-rouge">~reset_settings</code></em> parameter to <code class="language-plaintext highlighter-rouge">true</code> will reset all these settings to factory defaults.</p>

<p>:doc:<code class="language-plaintext highlighter-rouge">autogenerated/ardrone3_settings_param</code></p>

<hr />

<hr />

<hr />
<p>Coordinate System Conventions
<strong>**</strong><strong>**</strong><strong>**</strong><strong>**</strong>*****</p>

<p>.. _sec-coords:</p>

<h1 id="ros-standard-message-types-ie-twist-odometery---rep-103">ROS Standard Message Types (i.e Twist, Odometery) - REP 103</h1>

<p>+x    forward
+y    left
+z    up
+yaw  CCW</p>

<ul>
  <li>More information: http://www.ros.org/reps/rep-0103.html</li>
</ul>

<h1 id="bebop-velocities">Bebop Velocities</h1>

<p>+x    East
+y    South
+z    Down</p>

<h1 id="bebop-attitude">Bebop Attitude</h1>

<p>+x    forward
+y    right
+z    down
+yaw  CW</p>

<h1 id="sdks-setpilotingpcmd">SDK‚Äôs setPilotingPCMD</h1>

<p>+roll   right
+pitch  forward
+gaz    up
+yaw    CW</p>

<hr />

<hr />

<hr />
<p>Under The Hood
<strong>**</strong><strong>**</strong>**</p>

<p>This page contains information about the architecture of the driver and different techniques used for its development.</p>

<h1 id="automatic-code-generation">Automatic Code Generation</h1>

<p>TBA</p>

<h1 id="threading-model">Threading Model</h1>

<p>TBA</p>

<h1 id="publishing-the-states">Publishing the States</h1>

<p>TBA</p>

<p>.. _sec-dev-dyn:</p>

<h1 id="configuring-the-drone">Configuring the Drone</h1>

<p>TBA</p>

<p>.. _sec-dev-test:</p>

<h1 id="tests">Tests</h1>

<h2 id="enabling-bebop-in-the-loop-tests">Enabling Bebop In The Loop Tests</h2>

<p>.. code-block:: bash</p>

<p>$ cd /path/to/bebop_ws
  $ catkin clean ‚Äìcmake-cache
  $ catkin build bebop_driver ‚Äìcmake-args -DRUN_HARDWARE_TESTS=ON</p>

<h2 id="running-bebop-in-the-loop-tests">Running Bebop In The Loop Tests</h2>

<p>.. warning:: Bebop in the loop tests perform live unit tests with a real robot. Please proceed with caution and execute the tests in an area with at least 5 meters of clearance radius (empty space) around the Bebop.</p>

<p>.. code-block:: bash</p>

<p>$ cd /path/to/bebop_ws/build/bebop_driver
  $ make tests
  $ rostest ‚Äìtext bebop_driver bebop_itl_test.test</p>

<h1 id="upgrading-the-bebop-sdk">Upgrading the Bebop SDK</h1>

<p>.. warning:: Since version 0.6, <code class="language-plaintext highlighter-rouge">Parrot ARSDK &lt;http://developer.parrot.com/docs/SDK3/&gt;</code><em>, the main underlying dependency of  *bebop_autonomy* is not build inline anymore. Instead, the slightly patched and catkinized version of it, called <code class="language-plaintext highlighter-rouge">parrot_arsdk &lt;https://github.com/AutonomyLab/parrot_arsdk&gt;</code></em>, is fetched as a dependency. <strong>The following documentation needs to be updated</strong>.</p>

<ol>
  <li>Update the <code class="language-plaintext highlighter-rouge">GIT_TAG</code> of <code class="language-plaintext highlighter-rouge">ARDroneSDK3</code> in <code class="language-plaintext highlighter-rouge">bebop_driver/CMakeLists.txt::add_custom_target::./repo init ... -b GIT_TAG</code> to your desired commit hash, branch or tag (release). The official upstream repository is hosted <code class="language-plaintext highlighter-rouge">here &lt;https://github.com/Parrot-Developers/arsdk_manifests&gt;</code>_.</li>
  <li>Checkout (or browse) the upstream repository at the same hash used in step (1) and open <code class="language-plaintext highlighter-rouge">release.xml</code> file. From this file, extract the commit hash of <code class="language-plaintext highlighter-rouge">arsdk-xml</code> from the <code class="language-plaintext highlighter-rouge">revision</code> property of this XML tag: <code class="language-plaintext highlighter-rouge">&lt;project name="arsdk-xml" ... revision="" /&gt;</code>.</li>
  <li>Open <code class="language-plaintext highlighter-rouge">bebop_driver/scripts/meta/generate.py</code> and update <code class="language-plaintext highlighter-rouge">LIBARCOMMANDS_GIT_HASH</code> variable to the hash obtained in step (2).</li>
  <li>Change the working diretory to <code class="language-plaintext highlighter-rouge">bebop_driver/scripts/meta</code>, then execute <code class="language-plaintext highlighter-rouge">generate.py</code> from the command line. This will regenerate all automatically generated message definitions, header files and documentations.</li>
  <li>Copy the generated files to their target locations by calling <code class="language-plaintext highlighter-rouge">./install.sh</code>.</li>
  <li>In <code class="language-plaintext highlighter-rouge">bebop_driver/include/bebop_driver/autogenerated/ardrone3_setting_callbacks.h</code> change the following varialbles:</li>
</ol>

<ul>
  <li><code class="language-plaintext highlighter-rouge">ARCONTROLLER_DICTIONARY_KEY_ARDRONE3_PILOTINGSETTINGSSTATE_MAXDISTANCECHANGED_VALUE</code> to <code class="language-plaintext highlighter-rouge">ARCONTROLLER_DICTIONARY_KEY_ARDRONE3_PILOTINGSETTINGSSTATE_MAXDISTANCECHANGED_CURRENT</code>.</li>
  <li><code class="language-plaintext highlighter-rouge">ARCONTROLLER_DICTIONARY_KEY_ARDRONE3_PILOTINGSETTINGSSTATE_BANKEDTURNCHANGED_VALUE</code> to <code class="language-plaintext highlighter-rouge">ARCONTROLLER_DICTIONARY_KEY_ARDRONE3_PILOTINGSETTINGSSTATE_BANKEDTURNCHANGED_STATE</code></li>
  <li><code class="language-plaintext highlighter-rouge">ARCONTROLLER_DICTIONARY_KEY_ARDRONE3_PILOTINGSETTINGSSTATE_CIRCLINGRADIUSCHANGED_VALUE</code> to <code class="language-plaintext highlighter-rouge">ARCONTROLLER_DICTIONARY_KEY_ARDRONE3_PILOTINGSETTINGSSTATE_CIRCLINGRADIUSCHANGED_CURRENT</code></li>
  <li><code class="language-plaintext highlighter-rouge">ARCONTROLLER_DICTIONARY_KEY_ARDRONE3_PILOTINGSETTINGSSTATE_CIRCLINGALTITUDECHANGED_VALUE</code> to <code class="language-plaintext highlighter-rouge">ARCONTROLLER_DICTIONARY_KEY_ARDRONE3_PILOTINGSETTINGSSTATE_CIRCLINGALTITUDECHANGED_CURRENT</code></li>
</ul>

<p>In <code class="language-plaintext highlighter-rouge">bebop_driver/include/bebop_driver/autogenerated/ardrone3_state_callbacks.h</code> remove the following lines:</p>

<p><code class="language-plaintext highlighter-rouge">arg = NULL;
    HASH_FIND_STR (arguments, ARCONTROLLER_DICTIONARY_KEY_ARDRONE3_ACCESSORYSTATE_CONNECTEDACCESSORIES_LIST_FLAGS, arg);
    if (arg)
    {
      msg_ptr-&gt;list_flags = arg-&gt;value.U8;
    }</code></p>

<p>In <code class="language-plaintext highlighter-rouge">bebop_msgs/msg/autogenerated/Ardrone3AccessoryStateConnectedAccessories.msg</code> remove the following lines:
  <code class="language-plaintext highlighter-rouge"># List entry attribute Bitfield. 0x01: First: indicate its the first element of the list. 0x02: Last: indicate its the last element of the list. 0x04: Empty: indicate the list is empty (implies First/Last). All other arguments should be ignored. 0x08: Remove: This value should be removed from the existing list.
    uint8 list_flags</code></p>

<p>These changes are required because the upstream XML file is inconsistent for a couple of variable names.</p>

<ol>
  <li>Remove <code class="language-plaintext highlighter-rouge">build</code> and <code class="language-plaintext highlighter-rouge">devel</code> space of your <code class="language-plaintext highlighter-rouge">catkin</code> workspace, then re-build it.</li>
</ol>
:ET