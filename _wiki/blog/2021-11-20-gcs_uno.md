---
layout: post
title: "GCS uno server docs"
name: "gcs_uno"
tags: [gcs]
tagName: gcs
permalink: 2021-11-20-gcs_uno.html
sidebar: other_sidebar
folder: blog
collection: wiki
categories: drone
keywords: "drone, gcs"
summary: "Sat, Nov 20, 21, this guide will hoep to intall GCS uno server app along with NodeJs, Reds and RethingDB"
excerpt_separator: <!--more-->
toc: true
public: true
parent: [[Wiki-Setting-Category]]
date: 2022-01-05 T17:37:52 +0900
updated: 2022-01-05 17:37
---
* TOC
{:toc}

{{site.data.alerts.callout_warning}}This is a draft, the content is not complete and of poor quality!{{site.data.alerts.end}}

## gcs uno
## About GCS uno server
### basic installation
This guide will help you to install GCS.uno server app along with NodeJS, Redis Server and RethinkDB on Ubuntu 16.04 server.

If you don't have one, get it from Google Cloud, AWS, Digital Ocean or any other provider.
A server with 1 CPU, 1Gb RAM and 10Gb of hard drive will fit for testing.

You can also use VirtualBox with your desktop or laptop PC or even Raspberry Pi or similar card-size computers.

You will need SSH access to your server. Login and be ready to copy-paste below commands.

{{site.data.alerts.callout_info}}
GCS.uno server can be deployed on any system (Linux, MacOS, Windows). Check the original installation guides of the mentioned components on how to install on your favourite OS.
{{site.data.alerts.end}}

{{site.data.alerts.callout_warning}}
If you set up a server with cloud providers, check network firewall rules to allow access to UDP and TCP ports for telemetry and video streaming.
By default GCS.uno server uses UDP and TCP ports from 30000 to 65000 for telemetry, and TCP ports 554, 1935, 8081 for video streaming.
{{site.data.alerts.end}}

- system update

```shell
sudo apt-get update && sudo apt-get upgrade -y
```

- install helpers
```shell
sudo apt-get install curl git
```

- install nodejs
```shell
curl -sL https://deb.nodesource.com/setup_11.x | sudo -E bash -
```

```shell
sudo apt-get install -y nodejs build-essential
```

- install pm2 process manager

```shell
sudo npm install pm2 -g
```

-Install RethinkDB

```shell
source /etc/lsb-release && echo "deb http://download.rethinkdb.com/apt $DISTRIB_CODENAME main" | sudo tee /etc/apt/sources.list.d/rethinkdb.list
```

```shell
wget -qO- https://download.rethinkdb.com/apt/pubkey.gpg | sudo apt-key add -
```


```shell
sudo apt-get update && sudo apt-get install rethinkdb -y
```

- install Redis server
```shell
sudo apt-get install redis-server -y
```

### install GCS uno server app

```shell
sudo chown -R $USER:$GROUP ~/.npm
```


```shell
sudo chown -R $USER:$GROUP ~/.config
```
CD to you home directory if you are out of it

```shell
cd
```
Clone GCS.uno server repository

```shell
git clone git@github.com:aiegoo/gcs.eggs.or.kr.git
```

CD to project's directory:

```shell
cd gcs_uno_server
```

Install app dependencies

```shell
npm install
```
[initial-update](https://github.com/aiegoo/gcs.eggs.or.kr/commit/6eb2f660ae1f24d09c907a056256e50374d3e7d0)

Build front-end files
```shell
npm run build
```


## Setup your server
### Setting up RethinkDb database
Create RethinkDB instance config file

```shell
sudo cp config_templates/RethinkDB/gcs_uno_server.conf /etc/rethinkdb/instances.d/gcs_uno_server.conf
```

Create database instance directory

```shell
sudo rethinkdb create -d /var/lib/rethinkdb/gcs_uno_server
```


```shell
sudo chown -R rethinkdb.rethinkdb /var/lib/rethinkdb/gcs_uno_server
```


```shell
sudo /etc/init.d/rethinkdb start
```


```shell
sudo /etc/init.d/rethinkdb status
```

### Redis Server configuration

Redis Server does not need any additional configuration. Just check if it runs:
```shell    
sudo systemctl status redis
```

If you really need to change its configuration, the config file is here: `/etc/redis/redis.conf`

### Google Maps API Key¶
[utils_dataflash](697fead201349b367e3a2db931c618cfe043a1b3)

GCS.uno server uses Google Maps API for front-end maps and backend geocoding lookups, so you need to obtain your API key in order to use it. Here is the original guide of how to get [Google Maps API key](https://developers.google.com/maps/documentation/javascript/get-api-key).

After you have your API key, you need to put it in to files. Open index.html in gcs_uno_server/pilot-ui, find YOUR_API_KEY sting and replace it with your own key.


```shell
nano pilot-ui/index.html
```
Open `server_config.js` from configs directory and put your key in a GMAPS_API_KEY property:

```shell
nano configs/server_config.js
```

### Start app servers¶

First, cd to servers directory
```shell
cd ~/gcs_uno_server/servers
```
Then start application servers one by one with PM2 process manager.

```shell
pm2 start drones-server.js
```


```shell
pm2 start drone-udp-server.js
```


```shell
pm2 start gcs-tcp-server.js
```


```shell
pm2 start io-server.js
```

### Setup servers autostart on system boot¶

```shell
pm2 startup
```

### Open dashboard¶

Open your browser and go to http://YOUR_SERVER_IP:8080

[Video streaming server installation]()
[Advanced Installation (Custom domain with SSL)]()
[GCS.uno server dashboard overview]()

### advanced installation
If you want to use regular HTTP ports (80 and 443) for your server and/or assign a custom domain, you can install Nginx server and configure it as a reverse proxy with free SSL certificates from LetsEncrypt.


Install Nginx web server¶

```shell
sudo apt-get install nginx -y
# install LetsEncrypt certobx for nginx
sudo apt-get install software-properties-common -y
sudo apt-get update && sudo apt-get install python-certbot-nginx -y
```

Configure Ngnix¶

```shell
# Create new config file with your domain name. Replace GCS.EXAMPLE.COM with yours
sudo cp config_templates/Nginx/example_site.conf /etc/nginx/sites-available/GCS.EXAMPLE.COM
# Open it and set your domain name and root directory
sudo nano /etc/nginx/sites-available/GCS.EXAMPLE.COM
sudo ln -s /etc/nginx/sites-available/GCS.EXAMPLE.COM /etc/nginx/sites-enabled/GCS.EXAMPLE.COM
```

[certbot](https://certbot.eff.org/instructions?ws=nginx&os=ubuntufocal)

```shell
# Create SSL certificate for your domain¶
sudo certbot --nginx
```

Choose your site in console dialog, then wait a minute while your certificate is created and domain name checked. At the end of process you will be prompted to choose whether to make redirection in config file or not. Press 1 (No redirect) and Enter, because our config file already has redirection instructions.
Check your Nginx site config (from the steps above) if there are two lines with paths to certificate files at the end of file.
LetsEncrypt makes 3 months valid SSL certificate and sets itself to a cronjob to automatically renew it, so there is no need to do anything with it. But if you want to renew it manually, run this command:
```shell
sudo certbot renew --dry-run
```

Nginx proxy pass for Nimble streamer¶
If you have installed Nimble Streamer on the same system, you can put it beyond Nginx and share your domain name and SSL certificate for web-app video streaming.

Create new config file in Nginx conf.d directory

```shell
sudo cp config_templates/Nginx/nimble_proxy.conf /etc/nginx/conf.d/nimble_proxy.conf
```
Open your Nginx site config (from steps above), find and uncomment Nimble Proxy Pass section

```shell
sudo nano /etc/nginx/sites-available/GCS.EXAMPLE.COM
```
Restart Nginx

```shell
sudo systemctl restart nginx
```



```shell
sudo systemctl status nginx
```
Now you can access your dashboard with HTTPS connection, e.g. https://gcs.YOUR_DOMAIN.com

Follow with:
GCS.uno server dashboard overview


```shell

```



```shell

```

## Live video streaming
### Nimble Streamer setup for live video streaming
This guide describes basic installation and configuration of [Nimble Streamer media server](https://wmspanel.com/nimble).
Nimble Streamer is free (but not open source) media server. For advanced configuration you can use its user-friendly WMSPanel. Here is the original [installation guide](https://wmspanel.com/nimble/install#os_ubuntu).

#### installation

for Ubuntu 20.04

```shell
sudo bash -c 'echo -e "deb http://nimblestreamer.com/ubuntu focal/">> /etc/apt/sources.list'

wget -q -O - http://nimblestreamer.com/gpg.key | sudo apt-key add -

sudo apt-get update && sudo apt-get install nimble -y

sudo cp config_templates/Nimble/rules.conf /etc/nimble/rules.conf

sudo service nimble restart

sudo service nimble status
```

By default, Nimble Streamer will start automatically at system startup.
If you need to disable autostart, run this command


```shell
sudo service nimble disable
```
Nimble Streamer uses port 8081 for HTML5 websocket player. It can be changed in `/etc/nimble/nimble.conf` If you want to use Nginx server as a reverse proxy for Nimble Streamer, find more info in Advanced Installation page. If you change the Nimble Streamer port, remember to update the port in `/etc/nginx/sites-available/GCS.EXAMPLE.COM`

Register server in WMSPanel

Firstly, register an [WMSPanel](https://wmspanel.com/) account. Then register the nimble server.
After register WMSPanel, the configuration is controlled by the WMSPanel. the `/etc/nimble/rules.conf` will be overwritten. You have to go to WMSPanel to config the Interfaces for incoming published RTMP, RTSP and Icecast streams.

```shell
sudo /usr/bin/nimble_regutil
```

You will be asked for your WMSPanel login and password sent to you during sign up.

Regutil allows setting up specific display name for Nimble instance in WMSPanel via --server-name option.

```shell
sudo /usr/bin/nimble_regutil --server-name display_name`
```

#### Streaming live video
After you have your Nimble Streamer up and running, you can stream and view your live video.

Configure your device to stream to:

{{site.data.alerts_callout_info}}
RTSP: rtsp://YOUR_DOMAIN_OR_IP:554/vs/test_video_1
or RTMP: rtmp://YOUR_DOMAIN_OR_IP:1935/vs/test_video_1
{{site.data.end}}

Replace YOUR_DOMAIN_OR_IP with your server's configured domain name or IP address.
Instead of test_video_1 you can use whatever you like, this is a unique ID of a stream.

#### Streaming test video with GStreamer
If you don't have a camera or drone ready, it is possible to stream test video with GStreamer.

First install necessary packages along with GStreamer and its plugins (on the same server or any other suitable device)


```shell
sudo apt-get install -y autoconf automake libtool pkg-config libgstreamer1.0-dev libgstreamer-plugins-base1.0-dev gstreamer1.0-tools gstreamer1.0-plugins-good gstreamer1.0-plugins-bad gstreamer1.0-plugins-ugly

# Then set your streaming endpoint to the environment variable

STREAM_URL="rtmp://YOUR_DOMAIN_OR_IP:1935/vs/test_video_1"

# And run GStreamer with test video

gst-launch-1.0 videotestsrc is-live=true ! \
        clockoverlay halignment=right valignment=bottom text="video test" shaded-background=true font-desc="Sans, 32" ! \
        videoconvert ! videoscale ! videorate ! x264enc bitrate=500 tune=zerolatency ! video/x-h264 ! h264parse config-interval=1 ! \
        video/x-h264 ! queue ! flvmux name=mux ! \
        rtmpsink location="$STREAM_URL live=1" \
        audiotestsrc is-live=true ! audioconvert ! audiorate ! audioresample ! audio/x-raw,rate=48000 ! \
        voaacenc bitrate=24000 ! audio/mpeg ! aacparse ! audio/mpeg, mpegversion=4 ! mux.
```

Test video stream comes with current time overlay, so it's easy to estimate video latency.

#### View live video in GCS.uno web control panel¶
In a drone's settings form use the following URL pattern for video stream URLs:

SSL connection: wss://YOUR_DOMAIN_OR_IP/vs/test_video_1
No SSL: ws://YOUR_DOMAIN_OR_IP:8081/vs/test_video_1

View live video in QGroundControl or any RTMP or RTSP player¶
To view video, you can use QGroundControl (the lowest latency) or any desktop or mobile video player with RTSP or RTMP playback capabilities (e.g. VLC). Set them to play the RTSP stream with the following URL

rtsp://YOUR_DOMAIN_OR_IP:554/vs/test_video_1

{{site.data.alerts.callout_info}}
You can broadcast and view multiple streams with different IDs simultaneously. One stream can be viewed by multiple users. The overall number of publishers and viewers depends on your server performance.
{{site.data.alerts.end}}

Continue with:
Live video streaming with Wowza Cloud Streaming
Advanced Installation (Custom domain with SSL)
GCS.uno server dashboard overview

#### wmspanel
- Larix Grove on Android and Ios
![image](https://user-images.githubusercontent.com/42961200/148467022-b6441d12-0e77-49e8-bb01-80f3ffcd867d.png)


![image](https://user-images.githubusercontent.com/42961200/148466921-fd7ed527-c7ab-4439-80f2-20db9bd48a7f.png)


### Wowza Cloud streaming
This guide describes basic setup to stream live video from you DJI, Ardupilot or PX4 drone with the help of [Wowza Streaming Cloud](https://www.wowza.com/products/streaming-cloud) with Ultra Low-latency feature.


#### Create new stream target in Wowza Cloud¶
Log in to your [Wowza Streaming Cloud account](https://cloud.wowza.com/).
Click on Advanced menu on the top bar (1) and choose Stream Targets (2). Then click Add button to create new stream target (3):
![image](https://user-images.githubusercontent.com/42961200/142723923-dc6c24f9-18b6-46e3-8b77-9b6984340cc0.png)

Choose Wowza CDN-Ultra Low Latency(1) and click <kdb>add<kdb> button(2)
![image](https://user-images.githubusercontent.com/42961200/142723928-3f8bed13-bedc-473c-abac-9dba82b28532.png)

Enter your preferred stream name (1), choose Source Delivery Method as Push (2), set stream target to be enabled once it is created (3) and finally click Add (4):
![image](https://user-images.githubusercontent.com/42961200/142723931-520a9995-65c4-46ef-9995-a376971df1f1.png)

After stream target has been created, you will see its parameters page.
The Primary URL (1) is used to stream live video from your drone's camera. It is also used in GCS.uno iOS app for DJI drones to stream live video. The URL which starts with wss://... from Playback URLs section (2) should be copied as video stream URL to drone's settings in your GCS.uno web control panel. Click on Test player link to get your license key (3):
![image](https://user-images.githubusercontent.com/42961200/142723938-8be7d960-105b-4a41-9197-ff7eb9983472.png)

Copy your license key and continue with the next step:
![image](https://user-images.githubusercontent.com/42961200/142723945-adee5f09-a0d5-4eed-b444-e166d726eea6.png)

#### Configure your GCS.uno server with Wowza Player license key¶
To play live video from Wowza Cloud you need to set up your license key. This step needs to be done only once. Open pilot-ui/index.html and find Wowza Player initialization section:


```shell
<script type="text/javascript">
    window.WowzaPlayerLicense = "WOWZA_PLAYER_LICENSE_KEY"
</script>
```

Continue with:
Live video streaming with Nimble Streamer
GCS.uno server dashboard overview
## connect your drones

### Connect DJI drones to GCS.uno Server
![image](https://user-images.githubusercontent.com/42961200/142725569-589efb20-d45e-424a-9b83-d0236314a623.png)

DJI drones are connected to GCS.uno Server instance using our free [GCS.uno iOS app](https://docs.gcs.uno/ConnectDrone/GCS_uno_iOS_app/).
Please, install the app on your iOS mobile device before following next steps.

If you don't have your GCS.uno server running, please refer to GCS.uno Server installation guide or test the app and your drone with our GCS.uno DJI Test Server.

Create new drone in your GCS.uno control panel¶
Choose Drones in side menu (1), then click + New drone button (2):
![image](https://user-images.githubusercontent.com/42961200/142725575-72da2c8e-574b-45bc-bd63-f7aa6f8d1167.png)

Type in drone's name of your choice (1), choose DJI in Type menu (2) and click Create (3):
![image](https://user-images.githubusercontent.com/42961200/142725580-4be47421-b4ff-4cff-940a-e45b8aac109c.png)

Set live video playback URLs (1) and click Save (2):
![image](https://user-images.githubusercontent.com/42961200/142725590-035e9b6d-c1b5-4d4a-a2a6-317108a5c0e5.png)


#### Configure GCS.uno app¶
Connect your mobile device to DJI remote controller, turn them on and launch GCS.uno app.
![image](https://user-images.githubusercontent.com/42961200/142725705-a2c0ac80-2928-40d8-8cde-f9342b27d847.png)

Tap on menu button (1) and choose Settings (2).
![image](https://user-images.githubusercontent.com/42961200/142725727-b6d1ad6a-a48d-490f-9844-2baa53764a57.png)

Set your GCS.uno Server's host (1) and Auth Key (2). If your server uses SSL connection, switch on Use SSL (3). Set RTMP URL for live streaming video (4). Finally tap Save (5). If you are flying your drone in China, you have to login to DJI account (6).
![image](https://user-images.githubusercontent.com/42961200/142725733-3def9874-6e3e-4aae-b5b8-fe0f99d0e4b5.png)

{{site.data.alerts.callout_info}}
You can specify connection port in GCS.uno Server host field, e.g. you-gcs-uno-host.com:8080
If you don't specify connection port, the app will try to connect to default HTTP port 80 in case of SSL turned off. With SSL turned on the default port is 443.
Allowed auth keys for mobile device connections can be set in configs/server_config.js file in DJI_KEYS list.
{{site.data.alerts.end}}

{: .warning}
Note, that each key can be used by single device simultaneously. If you try to use a key which is currently used in active connection with other device, you'll get key in use error in the app's telemetry status.

Now, turn on your copter and wait until the app shows it is successfully connected:

![image](https://user-images.githubusercontent.com/42961200/142725735-00077774-0d91-4aea-aafe-2f3e719fef83.png)

Switch on telemetry (1) and video (2) streaming in side menu:
![image](https://user-images.githubusercontent.com/42961200/142725738-abf0018f-d9e8-4646-979d-a6c6b6cc2fa0.png)

After iOS app is connected, you will see online status in your drones list. Click on the drone's name and choose Control from the popup menu:
![image](https://user-images.githubusercontent.com/42961200/142725742-e90aee68-d498-42a9-bc92-a2ac4e3347bd.png)


#### Create new drone in your GCS.uno control panel¶
Choose Drones in side menu (1), then click + New drone button (2):
#### Configure GCS.uno app¶
Connect your mobile device to DJI remote controller, turn them on and launch GCS.uno app.

### Connect Ardupilot and PX4 drones¶

There are various ways of how to connect Ardupilot and PX4 autopilots to GCS.uno Server.

With in-field pilots¶
Re-stream telemetry and video from in-field laptop to GCS.uno Server and allow simultaneous control to remote operator:
![image](https://user-images.githubusercontent.com/42961200/142725752-dfbf7429-888f-4211-a7ea-cc9fe4cf8a8a.png)


Autonomous drones and rovers¶
Connect your autonomous drone's charging station to GCS.uno Server:
![image](https://user-images.githubusercontent.com/42961200/142725758-2c27071a-1dec-4040-8c2a-24e45269a63f.png)

Connect autonomous drones directly to GCS.uno server using onboard 3G, 4G and 5G cellular modems and terminals:
![image](https://user-images.githubusercontent.com/42961200/142725762-84305b33-36aa-44b3-9941-f999cdf0704b.png)

#### Create new drone in your GCS.uno control panel¶
Choose Drones in side menu (1), then click + New drone button (2):
![image](https://user-images.githubusercontent.com/42961200/142725775-9c8a9907-1196-4fe7-9c31-3246a2f519c6.png)

Type in drone's name of your choice (1), choose MAVLink in Type menu (2) and click Create (3):
![image](https://user-images.githubusercontent.com/42961200/142725777-6aa1ddd3-06de-4c43-9d68-51bc6cb330ba.png)


UDP port IN (1) and TCP port OUT (2) will be randomly set from the allowed range. Allowed ranges of UDP and TCP ports can be configured in configs/common_config.js file.
UDP port is used to stream MAVLink telemetry from drone. TCP port is used to connect desktop Ground Control software (QGroundControl, MissionPlanner etc) remotely. Set live video playback URLs (3) and click Save (4):
![image](https://user-images.githubusercontent.com/42961200/142725781-d4485762-3021-441e-b256-bc75a8dc387c.png)


{: .info}
You can set up to 3 playback URLs, which can be any of supported players type.
Stream video with Nimble Streamer
Stream video with Wowza Cloud Streaming

Click on the drone's name and choose Control from the popup menu:
![image](https://user-images.githubusercontent.com/42961200/142725785-8eb4b4d3-6813-4330-872e-8fc45870d9e5.png)

Once drone's dashboard is opened, click on Info icon (1) and switch on UDP server (2). If you are going to connect with desktop Ground Control software, you can also switch on TCP server (4) for this.
![image](https://user-images.githubusercontent.com/42961200/142725787-0a05675d-3abe-4f4f-ad5f-7cae91496e68.png)

Now turn on your drone together with ground equipment and configure them to stream telemetry to remote UDP port.
If connection is OK and your drone sends MAVLink data, the control dashboard will switch to Online mode and you will see telemetry data.
![image](https://user-images.githubusercontent.com/42961200/142725793-47b46e32-90f3-4188-9322-bf85276b9549.png)

Use your GCS.uno Server host and configured TCP port to connect with QGroundControl:
![image](https://user-images.githubusercontent.com/42961200/142725795-44511954-9b26-407f-891a-9c92c85fe908.png)


### Test with Ardupilot PX4 SITL simulators
Ardupilot SITL simulator¶
Install and run Ardupilot simulator by following the original guide: Basic multiplatform (Linux, Windows, MacOS) installation

PX4 Gazebo simulator¶
Here is the guide for [PX4 Gazebo sim](https://docs.px4.io/master/en/simulation/gazebo.html).


#### MAVProxy¶
If you have not installed MAVProxy yet, do it:

```shell
sudo apt-get install python-opencv python-wxgtk2.8 python-pip python-dev python-lxml python3-lxml
```

```shell
sudo pip install MAVProxy
```

#### Start all together¶
Refer to Connect MAVLink drone to start UDP server and get its port number.

Make sure autopilot simulator is up and running, then start MAVProxy to forward telemetry data to GCS.uno server (replace GCS_UNO_SERVER_HOST with you server's host or IP address and DRONE_PORT with the UDP port set in drone's settings:
```shell
mavproxy.py --master=udp:127.0.0.1:14550 --out=udpout:GCS_UNO_SERVER_HOST:DRONE_PORT
```

For example, test GCS.uno server is running on localhost (IP=127.0.0.1) with drone's UDP port=34111:
```shell
mavproxy.py --master=udp:127.0.0.1:14550 --out=udpout:127.0.0.1:34111
```

### GCS.uno iOS Mobile App Overview¶
GCS.uno iOS mobile app is designed to stream live video and telemetry from DJI drones to your own GCS.uno local or remote server allowing BVLOS view and control over the internet.
![image](https://user-images.githubusercontent.com/42961200/142725805-a3ad405a-36d0-45e5-ad1c-2f060aad6880.png)

![image](https://user-images.githubusercontent.com/42961200/142725812-4645e347-ac40-47ea-b5ba-2b6f5847216f.png)

Supported DJI drones:
![image](https://user-images.githubusercontent.com/42961200/142725815-b8f2effd-1743-40c3-b270-7f6785d38b79.png)

Supported iOS devices: iPhones and iPads running iOS 10 and above.
![image](https://user-images.githubusercontent.com/42961200/142725817-507c0f60-644f-4d27-b4be-6938bfa373e7.png)

If you don't have your GCS.uno server running, please refer to GCS.uno Server installation guide or test the app and your drone with our GCS.uno DJI test server.

Continue with:
Connect DJI drone to GCS.uno Server
GCS.uno DJI test server
Support forum
GCS.uno iOS app Privacy Policy


## fly your drone

### dashboard overview

![image](https://user-images.githubusercontent.com/42961200/142731351-d6f2f61a-7808-4509-b14b-4ef261076941.png)

- Telemetry widgets.
- Info icon. Click to view drone and connection info.
- Status messages icon. Click to view list of messages.
- Current flight mode name.
- Arm/disarm status and control buttons.
- Flight modes buttons.
- Additional actions and control menu.
- Drone's map marker.
- Home position marker.
- Live video screen.
- Live video sources switch.
- Camera control buttons.
- Flight indicators (artificial horizon, compass) and obstacles radar.
- Onscreen joystick controls (left - heading and altitude, right - move forward, backward, left and right).
- Camera gimbal control


#### parameter editor
#### preflight checklist
#### Geofence
#### semi-auto flight
#### auto mission flight
#### scheduled flight
```shell

```
## GCS usage
GCS.uno is a web-based Ground Control Station for autonomous drones with MAVLink-compatible autopilots.
![image](https://user-images.githubusercontent.com/42961200/142731051-2e736c99-25c0-4a5a-8261-b2157fd2f36f.png)


GCS.uno allows you to control multiple drones over internet.
How the drone's dashboard looks like in a web-app:
![image](https://user-images.githubusercontent.com/42961200/142731055-754f7fbb-784f-4833-a5df-01928f38d447.png)

### Setup options
To communicate with GCS.uno server your drone must have an internet link. This can be done in few ways, depending on what autopilot hardware is used.
Linux-based autopilots with USB 4G modem onboard
Such as Navio 2 hat for Raspberry Pi and Erle Brain 3.
![image](https://user-images.githubusercontent.com/42961200/142731063-99ee4a03-9cd5-44ae-955d-324631a2669f.png)

Use Navio2 + Raspberry setup guide for this option.
Autopilot board and separate companion computer with 4G onboard
Any MAVLink-compatible autopilot with any Linux-based onboard companion computer with 4G USB modem. Such as Pixhawk and [Odroid](https://www.hardkernel.com).
![image](https://user-images.githubusercontent.com/42961200/142731100-0d2dc9dc-da11-4750-9baf-a99aef7d4af8.png)

Setup companion computer.
In the both ways described above the 4G USB modem is used to directly communicate with GCS.uno server.
Regular radio modem link and companion computer on the ground
This is commonly used telemetry link with radio modem, such as RDF900 or SiK telemetry modems. The ground modem communicates with any computer. If computer is connected to internet, it can run GCS.uno script to connect with the server.
![image](https://user-images.githubusercontent.com/42961200/142731113-12d73978-8bf8-4bb4-a195-1366018c4300.png)

#### Connecting desktop and mobile Ground Control Station software
![image](https://user-images.githubusercontent.com/42961200/142731123-ff0a3d91-382b-42b6-989c-30092dd30760.png)

After setting up your drone to communicate with GCS.uno server you can use your favorite desktop or mobile Ground Control Station software to connect to it using GCS.uno as a MAVLink proxy server.
How to connect with QGroundControl and other Control Station software

### setup Navio2 and raspi

This guide describes how to set up Navio 2 autopilot and Raspberry Pi computer (or similar) to communicate with web-based ground control station GCS.uno over internet and 4G networks.
![image](https://user-images.githubusercontent.com/42961200/142731142-88aa5a59-a1ce-4cd2-8763-b58107a5697d.png)

Original docs for configuring Navio 2 autopilot board:
- Hardware setup
- Configuring Raspberry Pi
- Ardupilot installation and running
To configure your autopilot you need your board computer to be connected to a wifi network with internet available.

#### Connecting to GCS.uno
After you set up your drone and can connect with it using regular ground control software (such as QGroundControl or MissionPlanner), there are few steps left to control a drone remotely over 4G networks.

#### How it works
Ardupilot is configured to stream its MAVLink telemetry messages to local (onboard) UDP port. A small script (written in JavaScript) listens to this UDP port and transmits messages to GCS.uno server. When you open GCS.uno in a web-browser, this telemetry is got from server and rendered to a screen almost in realtime. In opposite direction, you press an action button on a web-page, this magically tranforms to a MAVLink message and reaches onboard autopilot to be executed.
SSH to your board Raspberry and follow next steps.

#### Configure Ardupilot
Depending on what frame you have configured using emlid-tool, the configuration file will be accordingly arducopter, arduplane or ardurover. Not ardupilot! Asuming you have arducopter, open config file:


```shell
sudo nano /etc/default/arducopter
```
Make sure these line are present or make copy-paste from here:

```shell
TELEM1="-A udp:127.0.0.1:14550"
ARDUPILOT_OPTS="$TELEM1"
```
ave it with Ctrl+X, y and restart Ardupilot
```shell
sudo systemctl daemon-reload
sudo systemctl restart arducopter

sudo systemctl status arducopter
```
It should be active and running:



#### Check MAVProxy
MAVProxy is used to be able to connect to autopilot using desktop GCS (over onboard or local WiFi) and our web-based GCS simultaneously. It is already installed in Emlid Raspbian image, just check it:
```shell
mavproxy.py --master=udp:127.0.0.1:14550 --out=tcpin:0.0.0.0:5762
```
It should looks like this:


Ctrl+C to exit.


#### Video streaming
GCS.uno has a video server which can be used to stream realtime RTSP video to your web-based dashboard. Next steps describe how to configure onboard Raspicam camera module.
```shell

sudo apt-get update
sudo apt-get install autoconf automake libtool pkg-config libgstreamer1.0-dev libgstreamer-plugins-base1.0-dev libraspberrypi-dev gstreamer1.0-tools gstreamer1.0-plugins-good gstreamer1.0-plugins-bad
```

If you have dependency warnings, try to solve them using following commands:

```shell
sudo apt-get install --fix-broken --assume-yes
sudo apt-get autoremove
sudo apt-get install -f && sudo dpkg --configure -a

```
CD to your home dir and clone gst-rpicamsrc (this is a GStreamer wrapper around the raspivid/raspistill functionality of the RaspberryPi):
```shell
cd
git clone https://github.com/GCS-uno/gst-rpicamsrc.git

cd rpicamsrc
chmod +x autogen.sh
./autogen.sh --prefix=/usr --libdir=/usr/lib/arm-linux-gnueabihf/
make
sudo make install

gst-launch-1.0 rpicamsrc bitrate=1000000 ! filesink location=test.h264
```
Ctrl+C after 10 seconds and check if file test.h264 exists and readable. Configuration of video streaming to GCS.uno servers is described in the next steps.

#### Install additional dependencies

NodeJs
```shell
curl -sL https://deb.nodesource.com/setup_10.x | sudo -E bash -
sudo apt-get install -y nodejs build-essential

curl -sL https://deb.nodesource.com/setup_10.x | sudo -E bash -
sudo apt-get install -y nodejs build-essential

# Download and install board scripts

cd
git clone https://github.com/GCS-uno/drone_board.git
cd drone_board
npm install
```

Inside drone_board directory you can find two shell scripts mavproxy.sh and video.sh which help running MAVProxy and video streaming. If you are sure not to use them, just skip to next step, otherwise make them executable:
```shell
chmod +x mavproxy.sh
chmod +x video.sh
```
#### Get your drone keys
Sign in to your GCS.uno dashboard, add new drone and get its MAVLink and Video keys.
![image](https://user-images.githubusercontent.com/42961200/142731217-25670e06-1d5f-4de3-9e79-7ca0d5690d2f.png)


Then put them in following commands to be readable by scripts. For MAVLink key (replace abcd1234 with one copied from dashboard):



```shell
DRONE_MAVLINK_KEY=abcd1234; echo "export DRONE_MAVLINK_KEY=$DRONE_MAVLINK_KEY" >>~/.bash_profile && source ~/.bash_profile

# The same for Video key (replace abcd1234):

DRONE_VIDEO_KEY=abcd1234; echo "export DRONE_VIDEO_KEY=$DRONE_VIDEO_KEY" >>~/.bash_profile && source ~/.bash_profile
```

#### Start board scripts

Check MavProxt script;
```shell
./mavproxy.sh

# If it looks good Ctrl+C to exit and then run it in bg with PM2 process managers
pm2 start mavproxy.sh --name mavproxy

# now run drone.js to check connection with GCS.uno server
node drone

# If it reports that connection is established, Ctrl+C to stop and run it again with PM2:
pm2 start drone.js --name drone

# And finally start script for video streaming:
pm2 start video.sh --name video
```

#### Enable scripts to start on system boot

Enable PM2 to start on boot:
```shell
pm2 startup

# This will prompt a sudo command which must be copied and executed to enable autostart. Then save list of active processes:
pm2 save
# check it
pm2 list

```
Now check your GCS.uno dashboard, you can see you drone's telemetry streaming.

#### Connect USB 4G modem

![image](https://user-images.githubusercontent.com/42961200/142731233-dda9d029-e128-4c82-a986-cb390a1152e6.png)



Almost all 4G modems work fine with Raspberry Pi computers without any additional configuration. Just check if you have SIM-card with enabled 4G internet option. Otherwise look into modem's manual to find out how to use it with Linux-based systems.


## Setup companion computer
How to set up companion computer to communicate with GCS.uno

These guide describes how to setup any Linux-based computer as a companion one. It can either be your laptop or headless Raspberry Pi on the ground or micro-PC onboard.

### How it works
Telemetry messages got from autopilot board over serial or USB port, by wires or radio link,  then a small script transmits these messages to GCS.uno server. When you open GCS.uno dashboard in a web-browser, this telemetry is got from server and rendered to a screen almost in realtime. In opposite direction, you press an action button on a web-page, this magically transforms to a MAVLink message and reaches onboard autopilot to be executed.
Assuming you have your computer running with internet connected and command shell available.


### Install MAVProxy
MAVProxy is a fully-functioning command-line GCS for UAVs. It is used to proxy one telemetry source to many different locations. For example, one for GCS.uno script, one for ROS, and another one for QGroundControl in local network.
Follow official MAVProxy manual to install it on your system.
### Telemetry source
If companion computer is placed onboard, it likely communicates with autopilot over serial (UART) port. Here is a good example of configuring Pixhawk with Raspberry Pi. Radio modems can be connected either over serial or USB port. Follow modem's manuals to connect it to your computer.
#### Serial port
Check it with MAVProxy:

```shell
sudo -s
mavproxy.py --master=/dev/ttyAMA0 --baudrate 57600

```
This command makes MAVProxy listen serial port 0 for telemetry messages and show autopilot's status messages in console. The same source will be also for a radio modem, connected over serial port.

#### usb port
Check it with MAVProxy:
```shell
sudo -s
mavproxy.py --master=/dev/ttyUSB0 --baudrate 57600

```

#### udp port
MAVProxy can also listen to local UDP port:
```shell
mavproxy.py --master=udp:127.0.0.1:UDP_PORT

```
If MAVProxy successfully connects with your autopilot continue with installing GCS.uno board scripts.

### Install additional dependencies


```shell
curl -sL https://deb.nodesource.com/setup_10.x | sudo -E bash -sudo apt-get install -y nodejs build-essential


sudo npm install pm2 -g


cd
git clone https://github.com/GCS-uno/drone_board.git
cd drone_board
npm install

```
Inside drone_board directory you can find two shell scripts mavproxy.sh and video.sh which help running MAVProxy and video streaming. If you are sure not to use them, just skip to next step, otherwise make them executable:


```shell
chmod +x mavproxy.sh
chmod +x video.sh

```
#### Get your drone keys
Sign in to your GCS.uno dashboard, add new drone and get its MAVLink and Video keys.
![image](https://user-images.githubusercontent.com/42961200/142731261-fa76b47d-4e98-4611-9870-5a29cd5ff1a3.png)

Then put them in following commands to be readable by scripts. For MAVLink key (replace abcd1234 with one copied from dashboard):

```shell
DRONE_MAVLINK_KEY=abcd1234; echo "export DRONE_MAVLINK_KEY=$DRONE_MAVLINK_KEY" >>~/.bash_profile && source ~/.bash_profile

# The same for Video key (replace abcd1234):
DRONE_VIDEO_KEY=abcd1234; echo "export DRONE_VIDEO_KEY=$DRONE_VIDEO_KEY" >>~/.bash_profile && source ~/.bash_profile
```
#### Start board scripts
Open mavproxy.sh file and put in MAVLink source in right way described above:

```shell
nano mavproxy.sh

./mavproxy.sh

# If it looks good Ctrl+C to exit and then run it in background with PM2 process manager:

pm2 start mavproxy.sh --name mavproxy
node drone
# If it reports that connection is established, Ctrl+C to stop and run it again with PM2:
pm2 start drone.js --name drone
pm2 startup
pm2 save
pm2 list
```
Now check your GCS.uno dashboard, you can see you drone's telemetry streaming.

## FPV video streaming
Streaming realtime FPV video to GCS.uno media server

GCS.uno has its own video streaming server. To setup Raspberry Pi camera module to stream video follow Video streaming section in Navio 2 and Raspberry setup guide.
If you deal with analog or HDMI video inputs, check Google how to set up your hardware to stream to media server. There are various formats in which video can be streamed: RTSP, RTMP, HTTP(S)-MPEG-TS. You need to get DRONE_VIDEO_KEY from your dashboard and replace it below.
RTSP stream address:
```shell
rtsp://video.gcs.uno:554/drone/DRONE_VIDEO_KEY

rtmp://video.gcs.uno:1935/drone/DRONE_VIDEO_KEY

http://video.gcs.uno:80/drone/DRONE_VIDEO_KEY/mpegts

https://video.gcs.uno:443/drone/DRONE_VIDEO_KEY/mpegts
```

## Connect with desktop GCS software
Connecting desktop and mobile Control Station software to GCS.uno MAVLink proxy server.

You can connect to your drone with your favorite desktop or mobile Control Station software using GCS.uno server.

### Get links
Log in to your dashboard and add your drone to list.
![image](https://user-images.githubusercontent.com/42961200/142731274-f6d8b72b-3793-4837-b7ee-e30c2eba25e6.png)



Name it somehow and click Create. After new drone is added, check if your drone's MAVLink System ID and MAVLink Component ID are correct. The default value for both of them is 1.
![image](https://user-images.githubusercontent.com/42961200/142731288-a76f32da-1c07-4a8a-9673-f3955da7997c.png)


Click on the name and choose GCS link in popup menu:

![image](https://user-images.githubusercontent.com/42961200/142731291-385cb4c8-bb4e-4d57-a77b-ca78c6b5fb34.png)


You can use these credentials to connect almost any MAVLink-compatible GCS software to your drone:
![image](https://user-images.githubusercontent.com/42961200/142731296-d7d25518-9bbf-4b71-8efe-ba4ceaf30984.png)


{: .note}
Due to security reasons this TCP-MAVLink bridge is locked to your IP address and will be destroyed after one hour. Each time you click GCS link in the menu, a new bridge is created and the previous one is destroyed.


### Connecting QGroundControl
OS: Windows, MacOS, Linux, iOS, Android
QGroundControl website: http://qgroundcontrol.com

#### Video streaming
If you configured video streaming to GCS.uno media server, then copy the RTSP URL above and put it to General settings in QGroundControl
![image](https://user-images.githubusercontent.com/42961200/142731308-58d4af35-f732-402a-94f1-c65032293c27.png)



#### Telemetry link
Move to Comm Links and click ADD button:
![image](https://user-images.githubusercontent.com/42961200/142731312-6b57afaa-c707-4610-b346-6a5770e7197c.png)



Choose connection type as TCP, name it, copy & paste host address and TCP port number and click OK:
![image](https://user-images.githubusercontent.com/42961200/142731316-577b37b7-2308-46a6-a045-8d06e1c08b5c.png)


Click on the GCS.uno link button just created and then click Connect:
![image](https://user-images.githubusercontent.com/42961200/142731320-f55f54f5-d532-41e2-b1b9-5c20622271fa.png)


After connecting use QGroundControl as usual:
![image](https://user-images.githubusercontent.com/42961200/142731327-72c1df1d-9fe3-41d0-8006-d560bfaebb4c.png)

```shell

```
## Flights history
### view and analyze logs

## Missions

### mission editor
```shell

```
## Use cases
#### parameter Monitoring
#### power and pipleline inspection
#### delivery drones
![image](https://user-images.githubusercontent.com/42961200/142726358-e06e09d1-ee39-46d9-a925-b14d89a9f42e.png)

```shell

```
## How tos


## refs
[node-mavlink](https://github.com/aiegoo/node-mavlink)

{% include taglogic.html %}

{% include links.html %}

{% include commento.html %}

{{site.data.alerts.hr_shaded}}
