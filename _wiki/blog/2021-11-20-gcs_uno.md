---
layout: post
title: "GCS uno server docs"
name: "gcs_uno"
tags: [gcs]
tagName: gcs
permalink: 2021-11-20-gcs_uno.html
sidebar: other_sidebar
folder: blog
collection: wiki
categories: drone
keywords: "drone, gcs"
summary: "Sat, Nov 20, 21, this guide will hoep to intall GCS uno server app along with NodeJs, Reds and RethingDB"
excerpt_separator: <!--more-->
toc: true
public: true
parent: [[Wiki-Setting-Category]]
date: 2021-11-20T17:37:52 +0900
updated: 2021-11-20 17:37
---
* TOC
{:toc}

{{site.data.alerts.callout_warning}}This is a draft, the content is not complete and of poor quality!{{site.data.alerts.end}}

## gcs uno
## About GCS uno server
### basic installation
This guide will help you to install GCS.uno server app along with NodeJS, Redis Server and RethinkDB on Ubuntu 16.04 server.

If you don't have one, get it from Google Cloud, AWS, Digital Ocean or any other provider.
A server with 1 CPU, 1Gb RAM and 10Gb of hard drive will fit for testing.

You can also use VirtualBox with your desktop or laptop PC or even Raspberry Pi or similar card-size computers.

You will need SSH access to your server. Login and be ready to copy-paste below commands.

{{site.data.alerts.callout_info}}
GCS.uno server can be deployed on any system (Linux, MacOS, Windows). Check the original installation guides of the mentioned components on how to install on your favourite OS.
{{site.data.alerts.end}}

{{site.data.alerts.callout_warning}}
If you set up a server with cloud providers, check network firewall rules to allow access to UDP and TCP ports for telemetry and video streaming.
By default GCS.uno server uses UDP and TCP ports from 30000 to 65000 for telemetry, and TCP ports 554, 1935, 8081 for video streaming.
{{site.data.alerts.end}}

- system update

```shell
sudo apt-get update && sudo apt-get upgrade -y
```

- install helpers
```shell
sudo apt-get install curl git
```

- install nodejs
```shell
curl -sL https://deb.nodesource.com/setup_11.x | sudo -E bash -
```

```shell
sudo apt-get install -y nodejs build-essential
```

- install pm2 process manager

```shell
sudo npm install pm2 -g
```

-Install RethinkDB

```shell
source /etc/lsb-release && echo "deb http://download.rethinkdb.com/apt $DISTRIB_CODENAME main" | sudo tee /etc/apt/sources.list.d/rethinkdb.list
```

```shell
wget -qO- https://download.rethinkdb.com/apt/pubkey.gpg | sudo apt-key add -
```


```shell
sudo apt-get update && sudo apt-get install rethinkdb -y
```

- install Redis server
```shell
sudo apt-get install redis-server -y
```

### install GCS uno server app

```shell
sudo chown -R $USER:$GROUP ~/.npm
```


```shell
sudo chown -R $USER:$GROUP ~/.config
```
CD to you home directory if you are out of it

```shell
cd
```
Clone GCS.uno server repository

```shell
git clone https://github.com/GCS-uno/gcs_uno_server.git
```

CD to project's directory:

```shell
cd gcs_uno_server
```

Install app dependencies

```shell
npm install
```

Build front-end files
```shell
npm run build
```


## Setup your server
### Setting up RethinkDb database
Create RethinkDB instance config file

```shell
sudo cp config_templates/RethinkDB/gcs_uno_server.conf /etc/rethinkdb/instances.d/gcs_uno_server.conf
```

Create database instance directory

```shell
sudo rethinkdb create -d /var/lib/rethinkdb/gcs_uno_server
```


```shell
sudo chown -R rethinkdb.rethinkdb /var/lib/rethinkdb/gcs_uno_server
```


```shell
sudo /etc/init.d/rethinkdb start
```


```shell
sudo /etc/init.d/rethinkdb status
```

### Redis Server configuration

Redis Server does not need any additional configuration. Just check if it runs:
```shell
sudo systemctl status redis
```

If you really need to change its configuration, the config file is here: `/etc/redis/redis.conf`

### Google Maps API Key¶

GCS.uno server uses Google Maps API for front-end maps and backend geocoding lookups, so you need to obtain your API key in order to use it. Here is the original guide of how to get [Google Maps API key](https://developers.google.com/maps/documentation/javascript/get-api-key).

After you have your API key, you need to put it in to files. Open index.html in gcs_uno_server/pilot-ui, find YOUR_API_KEY sting and replace it with your own key.


```shell
nano pilot-ui/index.html
```
Open `server_config.js` from configs directory and put your key in a GMAPS_API_KEY property:

```shell
nano configs/server_config.js
```

### Start app servers¶

First, cd to servers directory
```shell
cd ~/gcs_uno_server/servers
```
Then start application servers one by one with PM2 process manager.

```shell
pm2 start drones-server.js
```


```shell
pm2 start drone-udp-server.js
```


```shell
pm2 start gcs-tcp-server.js
```


```shell
pm2 start ui-server.js
```

### Setup servers autostart on system boot¶

```shell
pm2 startup
```

### Open dashboard¶

Open your browser and go to http://YOUR_SERVER_IP:8080

[Video streaming server installation]()
[Advanced Installation (Custom domain with SSL)]()
[GCS.uno server dashboard overview]()

### advanced installation
If you want to use regular HTTP ports (80 and 443) for your server and/or assign a custom domain, you can install Nginx server and configure it as a reverse proxy with free SSL certificates from LetsEncrypt.


Install Nginx web server¶

```shell
sudo apt-get install nginx -y
# install LetsEncrypt certobx for nginx
sudo apt-get install software-properties-common -y
sudo apt-get update && sudo apt-get install python-certbot-nginx -y
```

Configure Ngnix¶


```shell
# Create new config file with your domain name. Replace GCS.EXAMPLE.COM with yours
sudo cp config_templates/Nginx/example_site.conf /etc/nginx/sites-available/GCS.EXAMPLE.COM
# Open it and set your domain name and root directory
sudo nano /etc/nginx/sites-available/GCS.EXAMPLE.COM
sudo ln -s /etc/nginx/sites-available/GCS.EXAMPLE.COM /etc/nginx/sites-enabled/GCS.EXAMPLE.COM
# Create SSL certificate for your domain¶
sudo certbot --nginx
```
Choose your site in console dialog, then wait a minute while your certificate is created and domain name checked. At the end of process you will be prompted to choose whether to make redirection in config file or not. Press 1 (No redirect) and Enter, because our config file already has redirection instructions.
Check your Nginx site config (from the steps above) if there are two lines with paths to certificate files at the end of file.
LetsEncrypt makes 3 months valid SSL certificate and sets itself to a cronjob to automatically renew it, so there is no need to do anything with it. But if you want to renew it manually, run this command:
```shell
sudo certbot renew --dry-run
```

Nginx proxy pass for Nimble streamer¶
If you have installed Nimble Streamer on the same system, you can put it beyond Nginx and share your domain name and SSL certificate for web-app video streaming.

Create new config file in Nginx conf.d directory

```shell
sudo cp config_templates/Nginx/nimble_proxy.conf /etc/nginx/conf.d/nimble_proxy.conf
```
Open your Nginx site config (from steps above), find and uncomment Nimble Proxy Pass section

```shell
sudo nano /etc/nginx/sites-available/GCS.EXAMPLE.COM
```
Restart Nginx

```shell
sudo systemctl restart nginx
```



```shell
sudo systemctl status nginx
```
Now you can access your dashboard with HTTPS connection, e.g. https://gcs.YOUR_DOMAIN.com

Follow with:
GCS.uno server dashboard overview


```shell

```



```shell

```

## Live video streaming
### Nimble Streamer setup for live video streaming
This guide describes basic installation and configuration of [Nimble Streamer media server](https://wmspanel.com/nimble).
Nimble Streamer is free (but not open source) media server. For advanced configuration you can use its user-friendly WMSPanel. Here is the original [installation guide](https://wmspanel.com/nimble/install#os_ubuntu).

#### installation
```shell
echo 'deb http://nimblestreamer.com/ubuntu xenial/' | sudo tee --append /etc/apt/sources.list

wget -q -O - http://nimblestreamer.com/gpg.key | sudo apt-key add -

sudo apt-get update && sudo apt-get install nimble -y

sudo cp config_templates/Nimble/rules.conf /etc/nimble/rules.conf

sudo service nimble restart

sudo service nimble status
```

By default, Nimble Streamer will start automatically at system startup.
If you need to disable autostart, run this command


```shell
sudo service nimble disable
```
Nimble Streamer uses port 8081 for HTML5 websocket player. It can be changed in `/etc/nimble/nimble.conf` If you want to use Nginx server as a reverse proxy for Nimble Streamer, find more info in Advanced Installation page.

#### Streaming live video
After you have your Nimble Streamer up and running, you can stream and view your live video.

Configure your device to stream to:

RTSP: rtsp://YOUR_DOMAIN_OR_IP:554/vs/test_video_1
or RTMP: rtmp://YOUR_DOMAIN_OR_IP:1935/vs/test_video_1

Replace YOUR_DOMAIN_OR_IP with your server's configured domain name or IP address.
Instead of test_video_1 you can use whatever you like, this is a unique ID of a stream.

#### Streaming test video with GStreamer
If you don't have a camera or drone ready, it is possible to stream test video with GStreamer.

First install necessary packages along with GStreamer and its plugins (on the same server or any other suitable device)


```shell
sudo apt-get install -y autoconf automake libtool pkg-config libgstreamer1.0-dev libgstreamer-plugins-base1.0-dev gstreamer1.0-tools gstreamer1.0-plugins-good gstreamer1.0-plugins-bad gstreamer1.0-plugins-ugly

# Then set your streaming endpoint to the environment variable

STREAM_URL="rtmp://YOUR_DOMAIN_OR_IP:1935/vs/test_video_1"

# And run GStreamer with test video

gst-launch-1.0 videotestsrc is-live=true ! \
        clockoverlay halignment=right valignment=bottom text="video test" shaded-background=true font-desc="Sans, 32" ! \
        videoconvert ! videoscale ! videorate ! x264enc bitrate=500 tune=zerolatency ! video/x-h264 ! h264parse config-interval=1 ! \
        video/x-h264 ! queue ! flvmux name=mux ! \
        rtmpsink location="$STREAM_URL live=1" \
        audiotestsrc is-live=true ! audioconvert ! audiorate ! audioresample ! audio/x-raw,rate=48000 ! \
        voaacenc bitrate=24000 ! audio/mpeg ! aacparse ! audio/mpeg, mpegversion=4 ! mux.
```

Test video stream comes with current time overlay, so it's easy to estimate video latency.

#### View live video in GCS.uno web control panel¶
In a drone's settings form use the following URL pattern for video stream URLs:

SSL connection: wss://YOUR_DOMAIN_OR_IP/vs/test_video_1
No SSL: ws://YOUR_DOMAIN_OR_IP:8081/vs/test_video_1

View live video in QGroundControl or any RTMP or RTSP player¶
To view video, you can use QGroundControl (the lowest latency) or any desktop or mobile video player with RTSP or RTMP playback capabilities (e.g. VLC). Set them to play the RTSP stream with the following URL

rtsp://YOUR_DOMAIN_OR_IP:554/vs/test_video_1

{{site.data.alerts.callout_info}}
You can broadcast and view multiple streams with different IDs simultaneously. One stream can be viewed by multiple users. The overall number of publishers and viewers depends on your server performance.
{{site.data.alerts.end}}

Continue with:
Live video streaming with Wowza Cloud Streaming
Advanced Installation (Custom domain with SSL)
GCS.uno server dashboard overview

### Wowza Cloud streaming
This guide describes basic setup to stream live video from you DJI, Ardupilot or PX4 drone with the help of [Wowza Streaming Cloud](https://www.wowza.com/products/streaming-cloud) with Ultra Low-latency feature.


#### Create new stream target in Wowza Cloud¶
Log in to your [Wowza Streaming Cloud account](https://cloud.wowza.com/).
Click on Advanced menu on the top bar (1) and choose Stream Targets (2). Then click Add button to create new stream target (3):
![image](https://user-images.githubusercontent.com/42961200/142723923-dc6c24f9-18b6-46e3-8b77-9b6984340cc0.png)

Choose Wowza CDN-Ultra Low Latency(1) and click <kdb>add<kdb> button(2)
![image](https://user-images.githubusercontent.com/42961200/142723928-3f8bed13-bedc-473c-abac-9dba82b28532.png)

Enter your preferred stream name (1), choose Source Delivery Method as Push (2), set stream target to be enabled once it is created (3) and finally click Add (4):
![image](https://user-images.githubusercontent.com/42961200/142723931-520a9995-65c4-46ef-9995-a376971df1f1.png)

After stream target has been created, you will see its parameters page.
The Primary URL (1) is used to stream live video from your drone's camera. It is also used in GCS.uno iOS app for DJI drones to stream live video. The URL which starts with wss://... from Playback URLs section (2) should be copied as video stream URL to drone's settings in your GCS.uno web control panel. Click on Test player link to get your license key (3):
![image](https://user-images.githubusercontent.com/42961200/142723938-8be7d960-105b-4a41-9197-ff7eb9983472.png)

Copy your license key and continue with the next step:
![image](https://user-images.githubusercontent.com/42961200/142723945-adee5f09-a0d5-4eed-b444-e166d726eea6.png)

#### Configure your GCS.uno server with Wowza Player license key¶
To play live video from Wowza Cloud you need to set up your license key. This step needs to be done only once. Open pilot-ui/index.html and find Wowza Player initialization section:


```shell
<script type="text/javascript">
    window.WowzaPlayerLicense = "WOWZA_PLAYER_LICENSE_KEY"
</script>
```

Continue with:
Live video streaming with Nimble Streamer
GCS.uno server dashboard overview
## connect your drones

### Connect DJI drones to GCS.uno Server

DJI drones are connected to GCS.uno Server instance using our free [GCS.uno iOS app](https://docs.gcs.uno/ConnectDrone/GCS_uno_iOS_app/).
Please, install the app on your iOS mobile device before following next steps.

If you don't have your GCS.uno server running, please refer to GCS.uno Server installation guide or test the app and your drone with our GCS.uno DJI Test Server.

Create new drone in your GCS.uno control panel¶
Choose Drones in side menu (1), then click + New drone button (2):

Type in drone's name of your choice (1), choose DJI in Type menu (2) and click Create (3):

Set live video playback URLs (1) and click Save (2):

Tap on menu button (1) and choose Settings (2).

Set your GCS.uno Server's host (1) and Auth Key (2). If your server uses SSL connection, switch on Use SSL (3). Set RTMP URL for live streaming video (4). Finally tap Save (5). If you are flying your drone in China, you have to login to DJI account (6).

{{site.data.alerts.callout_info}}
You can specify connection port in GCS.uno Server host field, e.g. you-gcs-uno-host.com:8080
If you don't specify connection port, the app will try to connect to default HTTP port 80 in case of SSL turned off. With SSL turned on the default port is 443.
Allowed auth keys for mobile device connections can be set in configs/server_config.js file in DJI_KEYS list.
{{site.data.alerts.end}}

{: .warning}
Note, that each key can be used by single device simultaneously. If you try to use a key which is currently used in active connection with other device, you'll get key in use error in the app's telemetry status.

Now, turn on your copter and wait until the app shows it is successfully connected:


Switch on telemetry (1) and video (2) streaming in side menu:

After iOS app is connected, you will see online status in your drones list. Click on the drone's name and choose Control from the popup menu:


#### Create new drone in your GCS.uno control panel¶
Choose Drones in side menu (1), then click + New drone button (2):
#### Configure GCS.uno app¶
Connect your mobile device to DJI remote controller, turn them on and launch GCS.uno app.

### Connect Ardupilot and PX4 drones¶

There are various ways of how to connect Ardupilot and PX4 autopilots to GCS.uno Server.

With in-field pilots¶
Re-stream telemetry and video from in-field laptop to GCS.uno Server and allow simultaneous control to remote operator:


Autonomous drones and rovers¶
Connect your autonomous drone's charging station to GCS.uno Server:

Connect autonomous drones directly to GCS.uno server using onboard 3G, 4G and 5G cellular modems and terminals:


Type in drone's name of your choice (1), choose MAVLink in Type menu (2) and click Create (3):


UDP port IN (1) and TCP port OUT (2) will be randomly set from the allowed range. Allowed ranges of UDP and TCP ports can be configured in configs/common_config.js file.
UDP port is used to stream MAVLink telemetry from drone. TCP port is used to connect desktop Ground Control software (QGroundControl, MissionPlanner etc) remotely. Set live video playback URLs (3) and click Save (4):


{: .info}
You can set up to 3 playback URLs, which can be any of supported players type.
Stream video with Nimble Streamer
Stream video with Wowza Cloud Streaming

Click on the drone's name and choose Control from the popup menu:

Once drone's dashboard is opened, click on Info icon (1) and switch on UDP server (2). If you are going to connect with desktop Ground Control software, you can also switch on TCP server (4) for this.

Now turn on your drone together with ground equipment and configure them to stream telemetry to remote UDP port.
If connection is OK and your drone sends MAVLink data, the control dashboard will switch to Online mode and you will see telemetry data.

Use your GCS.uno Server host and configured TCP port to connect with QGroundControl:


### Test with Ardupilot PX4 SITL simulators
Ardupilot SITL simulator¶
Install and run Ardupilot simulator by following the original guide: Basic multiplatform (Linux, Windows, MacOS) installation

PX4 Gazebo simulator¶
Here is the guide for [PX4 Gazebo sim](https://docs.px4.io/master/en/simulation/gazebo.html).


#### MAVProxy¶
If you have not installed MAVProxy yet, do it:

```shell
sudo apt-get install python-opencv python-wxgtk2.8 python-pip python-dev python-lxml python3-lxml
```

```shell
sudo pip install MAVProxy
```

#### Start all together¶
Refer to Connect MAVLink drone to start UDP server and get its port number.

Make sure autopilot simulator is up and running, then start MAVProxy to forward telemetry data to GCS.uno server (replace GCS_UNO_SERVER_HOST with you server's host or IP address and DRONE_PORT with the UDP port set in drone's settings:
```shell
mavproxy.py --master=udp:127.0.0.1:14550 --out=udpout:GCS_UNO_SERVER_HOST:DRONE_PORT
```

For example, test GCS.uno server is running on localhost (IP=127.0.0.1) with drone's UDP port=34111:
```shell
mavproxy.py --master=udp:127.0.0.1:14550 --out=udpout:127.0.0.1:34111
```

### GCS.uno iOS Mobile App Overview¶
GCS.uno iOS mobile app is designed to stream live video and telemetry from DJI drones to your own GCS.uno local or remote server allowing BVLOS view and control over the internet.


Supported DJI drones:

Supported iOS devices: iPhones and iPads running iOS 10 and above.

If you don't have your GCS.uno server running, please refer to GCS.uno Server installation guide or test the app and your drone with our GCS.uno DJI test server.

Continue with:
Connect DJI drone to GCS.uno Server
GCS.uno DJI test server
Support forum
GCS.uno iOS app Privacy Policy


## fly your drone
```shell

```
## Flights history

## Missions
```shell

```
## Use cases
```shell

```
## How tos
```shell

```
## refs

{% include taglogic.html %}

{% include links.html %}

{% include commento.html %}

{{site.data.alerts.hr_shaded}}
