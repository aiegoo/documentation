---
layout: post
title: "GCS uno server docs"
name: "gcs_uno"
tags: [gcs]
tagName: gcs
permalink: 2021-11-20-gcs_uno.html
sidebar: other_sidebar
folder: blog
collection: wiki
categories: drone
keywords: "drone, gcs"
summary: "Sat, Nov 20, 21, this guide will hoep to intall GCS uno server app along with NodeJs, Reds and RethingDB"
excerpt_separator: <!--more-->
toc: true
public: true
parent: [[Wiki-Setting-Category]]
date: 2021-11-20T17:37:52 +0900
updated: 2021-11-20 17:37
---
* TOC
{:toc}

{{site.data.alerts.callout_warning}}This is a draft, the content is not complete and of poor quality!{{site.data.alerts.end}}

## gcs uno
## About GCS uno server
### basic installation
This guide will help you to install GCS.uno server app along with NodeJS, Redis Server and RethinkDB on Ubuntu 16.04 server.

If you don't have one, get it from Google Cloud, AWS, Digital Ocean or any other provider.
A server with 1 CPU, 1Gb RAM and 10Gb of hard drive will fit for testing.

You can also use VirtualBox with your desktop or laptop PC or even Raspberry Pi or similar card-size computers.

You will need SSH access to your server. Login and be ready to copy-paste below commands.

{{site.data.alerts.callout_info}}
GCS.uno server can be deployed on any system (Linux, MacOS, Windows). Check the original installation guides of the mentioned components on how to install on your favourite OS.
{{site.data.alerts.end}}

{{site.data.alerts.callout_warning}}
If you set up a server with cloud providers, check network firewall rules to allow access to UDP and TCP ports for telemetry and video streaming.
By default GCS.uno server uses UDP and TCP ports from 30000 to 65000 for telemetry, and TCP ports 554, 1935, 8081 for video streaming.
{{site.data.alerts.end}}

- system update

```shell
sudo apt-get update && sudo apt-get upgrade -y
```

- install helpers
```shell
sudo apt-get install curl git
```

- install nodejs
```shell
curl -sL https://deb.nodesource.com/setup_11.x | sudo -E bash -
```

```shell
sudo apt-get install -y nodejs build-essential
```

- install pm2 process manager

```shell
sudo npm install pm2 -g
```

-Install RethinkDB

```shell
source /etc/lsb-release && echo "deb http://download.rethinkdb.com/apt $DISTRIB_CODENAME main" | sudo tee /etc/apt/sources.list.d/rethinkdb.list
```

```shell
wget -qO- https://download.rethinkdb.com/apt/pubkey.gpg | sudo apt-key add -
```


```shell
sudo apt-get update && sudo apt-get install rethinkdb -y
```

- install Redis server
```shell
sudo apt-get install redis-server -y
```

### install GCS uno server app

```shell
sudo chown -R $USER:$GROUP ~/.npm
```


```shell
sudo chown -R $USER:$GROUP ~/.config
```
CD to you home directory if you are out of it

```shell
cd
```
Clone GCS.uno server repository

```shell
git clone https://github.com/GCS-uno/gcs_uno_server.git
```

CD to project's directory:

```shell
cd gcs_uno_server
```

Install app dependencies

```shell
npm install
```

Build front-end files
```shell
npm run build
```


## Setup your server
### Setting up RethinkDb database
Create RethinkDB instance config file

```shell
sudo cp config_templates/RethinkDB/gcs_uno_server.conf /etc/rethinkdb/instances.d/gcs_uno_server.conf
```

Create database instance directory

```shell
sudo rethinkdb create -d /var/lib/rethinkdb/gcs_uno_server
```


```shell
sudo chown -R rethinkdb.rethinkdb /var/lib/rethinkdb/gcs_uno_server
```


```shell
sudo /etc/init.d/rethinkdb start
```


```shell
sudo /etc/init.d/rethinkdb status
```

### Redis Server configuration

Redis Server does not need any additional configuration. Just check if it runs:
```shell
sudo systemctl status redis
```

If you really need to change its configuration, the config file is here: `/etc/redis/redis.conf`

### Google Maps API Key¶

GCS.uno server uses Google Maps API for front-end maps and backend geocoding lookups, so you need to obtain your API key in order to use it. Here is the original guide of how to get [Google Maps API key](https://developers.google.com/maps/documentation/javascript/get-api-key).

After you have your API key, you need to put it in to files. Open index.html in gcs_uno_server/pilot-ui, find YOUR_API_KEY sting and replace it with your own key.


```shell
nano pilot-ui/index.html
```
Open `server_config.js` from configs directory and put your key in a GMAPS_API_KEY property:

```shell
nano configs/server_config.js
```

### Start app servers¶

First, cd to servers directory
```shell
cd ~/gcs_uno_server/servers
```
Then start application servers one by one with PM2 process manager.

```shell
pm2 start drones-server.js
```


```shell
pm2 start drone-udp-server.js
```


```shell
pm2 start gcs-tcp-server.js
```


```shell
pm2 start ui-server.js
```

### Setup servers autostart on system boot¶

```shell
pm2 startup
```

### Open dashboard¶

Open your browser and go to http://YOUR_SERVER_IP:8080

[Video streaming server installation]()
[Advanced Installation (Custom domain with SSL)]()
[GCS.uno server dashboard overview]()

### advanced installation
If you want to use regular HTTP ports (80 and 443) for your server and/or assign a custom domain, you can install Nginx server and configure it as a reverse proxy with free SSL certificates from LetsEncrypt.


Install Nginx web server¶

```shell
sudo apt-get install nginx -y
# install LetsEncrypt certobx for nginx
sudo apt-get install software-properties-common -y
sudo apt-get update && sudo apt-get install python-certbot-nginx -y
```

Configure Ngnix¶


```shell
# Create new config file with your domain name. Replace GCS.EXAMPLE.COM with yours
sudo cp config_templates/Nginx/example_site.conf /etc/nginx/sites-available/GCS.EXAMPLE.COM
# Open it and set your domain name and root directory
sudo nano /etc/nginx/sites-available/GCS.EXAMPLE.COM
sudo ln -s /etc/nginx/sites-available/GCS.EXAMPLE.COM /etc/nginx/sites-enabled/GCS.EXAMPLE.COM
# Create SSL certificate for your domain¶
sudo certbot --nginx
```
Choose your site in console dialog, then wait a minute while your certificate is created and domain name checked. At the end of process you will be prompted to choose whether to make redirection in config file or not. Press 1 (No redirect) and Enter, because our config file already has redirection instructions.
Check your Nginx site config (from the steps above) if there are two lines with paths to certificate files at the end of file.
LetsEncrypt makes 3 months valid SSL certificate and sets itself to a cronjob to automatically renew it, so there is no need to do anything with it. But if you want to renew it manually, run this command:
```shell
sudo certbot renew --dry-run
```

Nginx proxy pass for Nimble streamer¶
If you have installed Nimble Streamer on the same system, you can put it beyond Nginx and share your domain name and SSL certificate for web-app video streaming.

Create new config file in Nginx conf.d directory

```shell
sudo cp config_templates/Nginx/nimble_proxy.conf /etc/nginx/conf.d/nimble_proxy.conf
```
Open your Nginx site config (from steps above), find and uncomment Nimble Proxy Pass section

```shell
sudo nano /etc/nginx/sites-available/GCS.EXAMPLE.COM
```
Restart Nginx

```shell
sudo systemctl restart nginx
```



```shell
sudo systemctl status nginx
```
Now you can access your dashboard with HTTPS connection, e.g. https://gcs.YOUR_DOMAIN.com

Follow with:
GCS.uno server dashboard overview


```shell

```



```shell

```

## Live video streaming
### Nimble Streamer setup for live video streaming
This guide describes basic installation and configuration of [Nimble Streamer media server](https://wmspanel.com/nimble).
Nimble Streamer is free (but not open source) media server. For advanced configuration you can use its user-friendly WMSPanel. Here is the original [installation guide](https://wmspanel.com/nimble/install#os_ubuntu).

#### installation
```shell
echo 'deb http://nimblestreamer.com/ubuntu xenial/' | sudo tee --append /etc/apt/sources.list

wget -q -O - http://nimblestreamer.com/gpg.key | sudo apt-key add -

sudo apt-get update && sudo apt-get install nimble -y

sudo cp config_templates/Nimble/rules.conf /etc/nimble/rules.conf

sudo service nimble restart

sudo service nimble status
```

By default, Nimble Streamer will start automatically at system startup.
If you need to disable autostart, run this command


```shell
sudo service nimble disable
```
Nimble Streamer uses port 8081 for HTML5 websocket player. It can be changed in `/etc/nimble/nimble.conf` If you want to use Nginx server as a reverse proxy for Nimble Streamer, find more info in Advanced Installation page.

#### Streaming live video
After you have your Nimble Streamer up and running, you can stream and view your live video.

Configure your device to stream to:

RTSP: rtsp://YOUR_DOMAIN_OR_IP:554/vs/test_video_1
or RTMP: rtmp://YOUR_DOMAIN_OR_IP:1935/vs/test_video_1

Replace YOUR_DOMAIN_OR_IP with your server's configured domain name or IP address.
Instead of test_video_1 you can use whatever you like, this is a unique ID of a stream.

#### Streaming test video with GStreamer
If you don't have a camera or drone ready, it is possible to stream test video with GStreamer.

First install necessary packages along with GStreamer and its plugins (on the same server or any other suitable device)


```shell
sudo apt-get install -y autoconf automake libtool pkg-config libgstreamer1.0-dev libgstreamer-plugins-base1.0-dev gstreamer1.0-tools gstreamer1.0-plugins-good gstreamer1.0-plugins-bad gstreamer1.0-plugins-ugly

# Then set your streaming endpoint to the environment variable

STREAM_URL="rtmp://YOUR_DOMAIN_OR_IP:1935/vs/test_video_1"

# And run GStreamer with test video

gst-launch-1.0 videotestsrc is-live=true ! \
        clockoverlay halignment=right valignment=bottom text="video test" shaded-background=true font-desc="Sans, 32" ! \
        videoconvert ! videoscale ! videorate ! x264enc bitrate=500 tune=zerolatency ! video/x-h264 ! h264parse config-interval=1 ! \
        video/x-h264 ! queue ! flvmux name=mux ! \
        rtmpsink location="$STREAM_URL live=1" \
        audiotestsrc is-live=true ! audioconvert ! audiorate ! audioresample ! audio/x-raw,rate=48000 ! \
        voaacenc bitrate=24000 ! audio/mpeg ! aacparse ! audio/mpeg, mpegversion=4 ! mux.
```

Test video stream comes with current time overlay, so it's easy to estimate video latency.

#### View live video in GCS.uno web control panel¶
In a drone's settings form use the following URL pattern for video stream URLs:

SSL connection: wss://YOUR_DOMAIN_OR_IP/vs/test_video_1
No SSL: ws://YOUR_DOMAIN_OR_IP:8081/vs/test_video_1

View live video in QGroundControl or any RTMP or RTSP player¶
To view video, you can use QGroundControl (the lowest latency) or any desktop or mobile video player with RTSP or RTMP playback capabilities (e.g. VLC). Set them to play the RTSP stream with the following URL

rtsp://YOUR_DOMAIN_OR_IP:554/vs/test_video_1

{{site.data.alerts.callout_info}}
You can broadcast and view multiple streams with different IDs simultaneously. One stream can be viewed by multiple users. The overall number of publishers and viewers depends on your server performance.
{{site.data.alerts.end}}

Continue with:
Live video streaming with Wowza Cloud Streaming
Advanced Installation (Custom domain with SSL)
GCS.uno server dashboard overview

### Wowza Cloud streaming
This guide describes basic setup to stream live video from you DJI, Ardupilot or PX4 drone with the help of [Wowza Streaming Cloud](https://www.wowza.com/products/streaming-cloud) with Ultra Low-latency feature.


#### Create new stream target in Wowza Cloud¶
Log in to your [Wowza Streaming Cloud account](https://cloud.wowza.com/).
Click on Advanced menu on the top bar (1) and choose Stream Targets (2). Then click Add button to create new stream target (3):
![image](https://user-images.githubusercontent.com/42961200/142723923-dc6c24f9-18b6-46e3-8b77-9b6984340cc0.png)

Choose Wowza CDN-Ultra Low Latency(1) and click <kdb>add<kdb> button(2)
![image](https://user-images.githubusercontent.com/42961200/142723928-3f8bed13-bedc-473c-abac-9dba82b28532.png)

Enter your preferred stream name (1), choose Source Delivery Method as Push (2), set stream target to be enabled once it is created (3) and finally click Add (4):
![image](https://user-images.githubusercontent.com/42961200/142723931-520a9995-65c4-46ef-9995-a376971df1f1.png)

After stream target has been created, you will see its parameters page.
The Primary URL (1) is used to stream live video from your drone's camera. It is also used in GCS.uno iOS app for DJI drones to stream live video. The URL which starts with wss://... from Playback URLs section (2) should be copied as video stream URL to drone's settings in your GCS.uno web control panel. Click on Test player link to get your license key (3):
![image](https://user-images.githubusercontent.com/42961200/142723938-8be7d960-105b-4a41-9197-ff7eb9983472.png)

Copy your license key and continue with the next step:
![image](https://user-images.githubusercontent.com/42961200/142723945-adee5f09-a0d5-4eed-b444-e166d726eea6.png)

#### Configure your GCS.uno server with Wowza Player license key¶
To play live video from Wowza Cloud you need to set up your license key. This step needs to be done only once. Open pilot-ui/index.html and find Wowza Player initialization section:


```shell
<script type="text/javascript">
    window.WowzaPlayerLicense = "WOWZA_PLAYER_LICENSE_KEY"
</script>
```


## connect your drones

```shell

```
## fly your drone
```shell

```
## Flights history

## Missions
```shell

```
## Use cases
```shell

```
## How tos
```shell

```
## refs

{% include taglogic.html %}

{% include links.html %}

{% include commento.html %}

{{site.data.alerts.hr_shaded}}
